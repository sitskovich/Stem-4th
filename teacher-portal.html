<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Portal - 4th Grade STEM Curriculum</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .welcome-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .whats-next-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
        }

        .whats-next-section h2 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .next-lesson-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 30px;
        }

        .next-lesson-info {
            flex: 1;
        }

        .next-lesson-info h3 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .next-lesson-info p {
            color: rgba(255,255,255,0.9);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .lesson-progress {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            color: white;
            font-weight: 600;
            min-width: 100px;
        }

        .next-lesson-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .welcome-section h1 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .timeline {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .timeline h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .timeline-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .timeline-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .timeline-item h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .timeline-item.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .timeline-item.clickable:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            background: #e3f2fd;
        }

        .timeline-item.clickable i {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #667eea;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .timeline-item.clickable:hover i {
            opacity: 1;
            transform: translateX(3px);
        }

        .bundle-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .bundle-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .bundle-icon {
            font-size: 2.5rem;
            color: #667eea;
        }

        .bundle-info h2 {
            color: #333;
            margin-bottom: 5px;
        }

        .bundle-info p {
            color: #666;
        }

        .lesson-structure {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .lesson-structure h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .slide-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .slide-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #28a745;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .slide-item h4 {
            color: #333;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .slide-item p {
            color: #666;
            font-size: 0.8rem;
        }

        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .resource-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .resource-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .resource-card ul {
            list-style: none;
            padding-left: 0;
        }

        .resource-card li {
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .resource-card li:last-child {
            border-bottom: none;
        }

        .assessment-overview {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }

        .assessment-overview h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .assessment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .assessment-item {
            background: #ffffff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .assessment-item h4 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .assessment-item p {
            color: #666;
            margin: 0;
            font-size: 0.9em;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .gemini-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
        }

        .gemini-section h2 {
            color: white;
            margin-bottom: 10px;
            text-align: center;
        }

        .gemini-section p {
            color: rgba(255,255,255,0.9);
            text-align: center;
            margin-bottom: 30px;
        }

        .gemini-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .gemini-categories h3 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .category-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .category-card:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
            border-color: rgba(255,255,255,0.4);
        }

        .category-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: white;
        }

        .category-card h4 {
            color: white;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .category-card p {
            color: rgba(255,255,255,0.8);
            font-size: 0.8rem;
            margin: 0;
        }

        .gemini-chat {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(255,255,255,0.05);
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .bot-message {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 12px 15px;
            border-radius: 15px;
            border-bottom-left-radius: 5px;
        }

        .user-message {
            background: rgba(255,255,255,0.3);
            color: white;
            padding: 12px 15px;
            border-radius: 15px;
            border-bottom-right-radius: 5px;
            margin-left: auto;
            max-width: 70%;
        }

        .message i {
            margin-top: 2px;
            font-size: 1.1rem;
        }

        .chat-input {
            display: flex;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            background: rgba(255,255,255,0.1);
            color: white;
            transition: border-color 0.3s ease;
        }

        .chat-input input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .chat-input input:focus {
            border-color: rgba(255,255,255,0.6);
        }

        .chat-input button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            margin-left: 10px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .chat-input button:hover {
            background: rgba(255,255,255,0.3);
        }

        .collapsible-section {
            background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .section-header {
            padding: 30px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .section-header:hover {
            background: rgba(255,255,255,0.1);
        }

        .section-header h2 {
            color: white;
            margin: 0;
            flex: 1;
        }

        .section-header p {
            color: rgba(255,255,255,0.9);
            margin: 5px 0 0 0;
            flex: 1;
        }

        .toggle-indicator {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s ease;
        }

        .toggle-indicator i {
            font-size: 1.2rem;
            color: white;
        }

        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: rgba(255,255,255,0.05);
        }

        .section-content.expanded {
            max-height: 2000px;
        }

        .section-content .gemini-container,
        .section-content .tools-tabs {
            padding: 30px;
        }

        .integrated-tools-section {
            background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
        }

        .integrated-tools-section h2 {
            color: white;
            margin-bottom: 10px;
            text-align: center;
        }

        .integrated-tools-section p {
            color: rgba(255,255,255,0.9);
            text-align: center;
            margin-bottom: 30px;
        }

        .tools-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .tab-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
        }

        .tab-btn.active {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.6);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ClassDojo Styles */
        .classdojo-dashboard, .veracross-dashboard, .grading-dashboard {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .classdojo-header, .veracross-header, .grading-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .classdojo-header h3, .veracross-header h3, .grading-header h3 {
            color: white;
            margin: 0;
        }

        .classdojo-actions, .veracross-actions, .grading-actions {
            display: flex;
            gap: 10px;
        }

        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .student-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .student-card:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
        }

        .student-avatar {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .student-card h4 {
            color: white;
            margin-bottom: 15px;
        }

        .student-points {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .points-positive {
            color: #28a745;
            font-weight: bold;
        }

        .points-negative {
            color: #dc3545;
            font-weight: bold;
        }

        .recent-behaviors {
            font-size: 0.9rem;
        }

        .behavior-positive {
            color: #28a745;
        }

        .behavior-negative {
            color: #dc3545;
        }

        /* Veracross Styles */
        .gradebook-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .gradebook-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
        }

        .gradebook-card h4 {
            color: white;
            margin-bottom: 15px;
        }

        .grade-stats {
            display: flex;
            gap: 20px;
        }

        .stat {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
        }

        .recent-grades {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .grade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .grade {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .grade.A {
            background: #28a745;
            color: white;
        }

        .grade.B {
            background: #ffc107;
            color: #333;
        }

        .attendance-summary {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
        }

        .attendance-summary h4 {
            color: white;
            margin-bottom: 15px;
        }

        .attendance-stats {
            display: flex;
            gap: 30px;
        }

        .attendance-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .attendance-item.present {
            color: #28a745;
        }

        .attendance-item.absent {
            color: #dc3545;
        }

        /* Grading Styles */
        .grading-interface {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
        }

        .assignment-selector {
            margin-bottom: 25px;
        }

        .assignment-selector label {
            color: white;
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .assignment-selector select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1rem;
        }

        .assignment-selector select option {
            background: #333;
            color: white;
        }

        .grading-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .grading-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: center;
        }

        .student-info {
            display: flex;
            flex-direction: column;
        }

        .student-name {
            color: white;
            font-weight: 500;
        }

        .student-id {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        .grade-input {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .grade-input input {
            width: 60px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            text-align: center;
        }

        .feedback-input input {
            width: 200px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .btn-small {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .btn-small:hover {
            background: rgba(255,255,255,0.3);
        }

        /* ClassDojo Integration Styles */
        .classdojo-signin {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }

        .signin-content h4 {
            color: white;
            margin-bottom: 15px;
        }

        .signin-content p {
            color: rgba(255,255,255,0.8);
            margin-bottom: 20px;
        }

        .google-signin-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .google-signin-btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
        }

        .google-signin-btn i {
            font-size: 1.2rem;
        }

        .signin-note {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.6);
            margin: 0;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
        }

        .class-info h4 {
            color: white;
            margin: 0 0 5px 0;
        }

        .class-info p {
            color: rgba(255,255,255,0.8);
            margin: 0;
        }

        .dashboard-actions {
            display: flex;
            gap: 10px;
        }

        /* Avatar Selection Styles */
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .avatar-option {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .avatar-option:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
        }

        .avatar-option.selected {
            border-color: #28a745;
            background: rgba(40,167,69,0.2);
        }

        .avatar-option .avatar-emoji {
            font-size: 2.5rem;
            margin-bottom: 8px;
            display: block;
        }

        .avatar-option .avatar-name {
            color: white;
            font-size: 0.9rem;
            margin: 0;
        }

        .ai-tools-section {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
        }

        .ai-tools-section h2 {
            color: white;
            margin-bottom: 25px;
            text-align: center;
        }

        .ai-tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .ai-tool-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .ai-tool-card:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-5px);
            border-color: rgba(255,255,255,0.4);
        }

        /* Digital Tools Section */
        .digital-tools-section {
            margin-bottom: 30px;
        }

        .digital-tools-section h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .digital-tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .digital-tool-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 15px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .digital-tool-link:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border-color: rgba(255,255,255,0.3);
            color: white;
            text-decoration: none;
        }

        .digital-tool-link i {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .digital-tool-link span {
            font-weight: 500;
            text-align: center;
        }

        .service-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .service-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .service-card p {
            opacity: 0.9;
            font-size: 1rem;
        }

        /* ClassDojo Integration Styles */
        .classdojo-integration {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .integration-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .integration-header h3 {
            color: #2d3748;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .integration-header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .integration-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .classdojo-preview {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .preview-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .classdojo-logo {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .preview-header h4 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .preview-header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .preview-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .preview-students {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .student-preview {
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .student-avatar {
            font-size: 1.2rem;
        }

        .student-name {
            flex: 1;
            font-size: 0.9rem;
        }

        .student-points {
            color: #48bb78;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .integration-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .integration-actions .btn-primary,
        .integration-actions .btn-secondary {
            width: 100%;
            padding: 15px 20px;
            font-size: 1rem;
        }

        /* Modal Overlay Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-content.large-modal {
            max-width: 800px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .modal-header h2,
        .modal-header h3 {
            color: #2d3748;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #e2e8f0;
            color: #2d3748;
        }

        .modal-body {
            color: #4a5568;
        }

        .ai-tool-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .ai-tool-card h3 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .ai-tool-card p {
            color: rgba(255,255,255,0.9);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Enhanced Lesson Plan Generator Styles */
        .lesson-plan-generator {
            max-width: 800px;
            margin: 0 auto;
        }

        .generator-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
        }

        .generator-header h4 {
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .generator-header p {
            opacity: 0.9;
            margin: 0;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .generator-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .result-actions {
            display: flex;
            gap: 10px;
        }

        .lesson-plan-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            line-height: 1.6;
        }

        .lesson-plan-content h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .lesson-plan-content h5 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .lesson-plan-content ul, .lesson-plan-content ol {
            margin-bottom: 15px;
            padding-left: 20px;
        }

        .lesson-plan-content li {
            margin-bottom: 5px;
        }

        .lesson-plan-content .highlight-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .lesson-plan-content .materials-list {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* Bundle Selection Styles */
        .bundle-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bundle-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bundle-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .bundle-option-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .bundle-option h4 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .bundle-option p {
            color: #666;
            font-size: 0.9rem;
            margin: 0;
        }

        .digital-tools {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tool-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: transform 0.3s ease;
        }

        .tool-item:hover {
            transform: translateY(-5px);
        }

        .tool-item i {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .timeline-grid {
                grid-template-columns: 1fr;
            }
            
            .resources-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Back to Main Hub
            </a>
            <h1><i class="fas fa-chalkboard-teacher"></i> Teacher Portal</h1>
            <div>
                <a href="interactive-teacher-portal.html" class="btn" style="margin-left:10px;background:#28a745"><i class="fas fa-presentation"></i> Launch Interactive Slides</a>
                <a href="admin-panel.html" class="btn" style="margin-left:10px;background:#dc3545"><i class="fas fa-shield-alt"></i> Admin Panel</a>
            </div>
        </div>
    </div>

    <div class="container" id="mainContent">
        <div class="welcome-section">
            <h1>Welcome to Your 4th Grade STEM Curriculum Hub</h1>
            <p>This comprehensive portal contains all the resources you need to deliver engaging, NGSS-aligned science instruction. Each bundle is designed to be taught over 8-9 weeks, with detailed lesson plans, interactive presentations, and assessment materials.</p>
        </div>

        <!-- What's Next Section -->
        <div class="whats-next-section">
            <h2><i class="fas fa-forward"></i> What's Next</h2>
            <div class="next-lesson-card">
                <div class="next-lesson-info">
                    <h3 id="nextLessonTitle">Ready to Start Your Journey!</h3>
                    <p id="nextLessonDescription">Select a lesson to begin tracking your progress through the curriculum.</p>
                    <div class="lesson-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <span id="progressText">0% Complete</span>
                    </div>
                </div>
                <div class="next-lesson-actions">
                    <button class="btn-primary" id="continueLessonBtn" onclick="continueLesson()" style="display: none;">
                        <i class="fas fa-play"></i> Continue Lesson
                    </button>
                    <button class="btn-secondary" onclick="resetProgress()">
                        <i class="fas fa-refresh"></i> Reset Progress
                    </button>
                </div>
            </div>
        </div>

        <div class="timeline">
            <h2><i class="fas fa-calendar-alt"></i> Academic Year Timeline</h2>
            <div class="timeline-grid">
                <div class="timeline-item clickable" onclick="openBundle('bundle1')">
                    <h3>Bundle 1: Sept-Oct</h3>
                    <p>Organism Structures & Behavior</p>
                    <p><strong>6-7 weeks</strong> • 12 lessons</p>
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="timeline-item clickable" onclick="openBundle('bundle2')">
                    <h3>Bundle 2: Nov-Dec</h3>
                    <p>Earth's Surface & Resources</p>
                    <p><strong>7-8 weeks</strong> • 14 lessons</p>
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="timeline-item clickable" onclick="openBundle('bundle3')">
                    <h3>Bundle 3: Jan-Feb</h3>
                    <p>Energy & Forces</p>
                    <p><strong>6-7 weeks</strong> • 12 lessons</p>
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="timeline-item clickable" onclick="openBundle('bundle4')">
                    <h3>Bundle 4: Mar-May</h3>
                    <p>Engineering & Design</p>
                    <p><strong>5-6 weeks</strong> • 10 lessons</p>
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>
        </div>

        <!-- Bundle 1 -->
        <div class="bundle-section">
            <div class="bundle-header clickable" onclick="toggleBundle('bundle1')">
                <div class="bundle-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <div class="bundle-info">
                    <h2>Bundle 1: Organism Structures & Behavior</h2>
                    <p>Life Science • 8-9 weeks • September-October 2025</p>
                </div>
                <div class="bundle-toggle">
                    <i class="fas fa-chevron-down" id="bundle1-chevron"></i>
                </div>
            </div>
            <div class="bundle-content" id="bundle1-content" style="display: none;">

            <div class="lesson-structure">
                <h3><i class="fas fa-list-ol"></i> Lesson Structure (7+ slides minimum)</h3>
                <div class="slide-list">
                    <div class="slide-item">
                        <h4>Slide 1: Warm-up</h4>
                        <p>Engaging question or activity to activate prior knowledge</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 2: Learning Objectives</h4>
                        <p>Clear, measurable goals for the lesson</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 3: Vocabulary</h4>
                        <p>Key terms with definitions and examples</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 4: Content Introduction</h4>
                        <p>Basic concepts and foundational knowledge</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 5: Content Deep Dive</h4>
                        <p>More complex concepts and detailed explanations</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 6: Content Application</h4>
                        <p>Real-world examples and problem-solving scenarios</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 7: Digital Citizenship</h4>
                        <p>Online safety, research skills, and digital ethics</p>
                    </div>
                </div>
            </div>

            <div class="resources-grid">
                <div class="resource-card">
                    <h4><i class="fas fa-file-powerpoint"></i> Lesson Presentations</h4>
                    <ul>
                        <li>4th_Grade_STEM_Bundle1_Organism_Structures.pptx</li>
                        <li>Bundle1_Plant_Animal_Structures_Lesson_Draft.pptx</li>
                        <li>Bundle1_VisualEnhanced.pptx</li>
                    </ul>
                </div>
                <div class="resource-card">
                    <h4><i class="fas fa-book"></i> NGSS Documents</h4>
                    <ul>
                        <li>Lesson Planning Guide Front Matter</li>
                        <li>Mission Log</li>
                        <li>Sample Lesson Plans</li>
                    </ul>
                </div>
            </div>
            </div>
        </div>

        <!-- Bundle 2 -->
        <div class="bundle-section">
            <div class="bundle-header clickable" onclick="toggleBundle('bundle2')">
                <div class="bundle-icon">
                    <i class="fas fa-mountain"></i>
                </div>
                <div class="bundle-info">
                    <h2>Bundle 2: Changes Over Time to Earth's Surface & Resources</h2>
                    <p>Earth Science • 8-9 weeks • November-December 2025</p>
                </div>
                <div class="bundle-toggle">
                    <i class="fas fa-chevron-down" id="bundle2-chevron"></i>
                </div>
            </div>
            <div class="bundle-content" id="bundle2-content" style="display: none;">

            <div class="lesson-structure">
                <h3><i class="fas fa-list-ol"></i> Lesson Structure (7+ slides minimum)</h3>
                <div class="slide-list">
                    <div class="slide-item">
                        <h4>Slide 1: Warm-up</h4>
                        <p>Earth science observation or prediction activity</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 2: Learning Objectives</h4>
                        <p>Earth science and resource management goals</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 3: Vocabulary</h4>
                        <p>Geological and environmental terms</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 4: Content Introduction</h4>
                        <p>Basic earth processes and resource concepts</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 5: Content Deep Dive</h4>
                        <p>Detailed exploration of earth changes</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 6: Content Application</h4>
                        <p>Local examples and environmental impact</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 7: Digital Citizenship</h4>
                        <p>Environmental research and data analysis</p>
                    </div>
                </div>
            </div>

            <div class="resources-grid">
                <div class="resource-card">
                    <h4><i class="fas fa-file-pdf"></i> NGSS Documents</h4>
                    <ul>
                        <li>Bundle2_ChangesOverTimetoEarthsSurface_LessonPlanningGuide.pdf</li>
                        <li>Earth Science Assessment Materials</li>
                    </ul>
                </div>
            </div>
            </div>
        </div>

        <!-- Bundle 3 -->
        <div class="bundle-section">
            <div class="bundle-header clickable" onclick="toggleBundle('bundle3')">
                <div class="bundle-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="bundle-info">
                    <h2>Bundle 3: Using Energy Transformations</h2>
                    <p>Physical Science • 6-7 weeks • January-February 2026</p>
                </div>
                <div class="bundle-toggle">
                    <i class="fas fa-chevron-down" id="bundle3-chevron"></i>
                </div>
            </div>
            <div class="bundle-content" id="bundle3-content" style="display: none;">

            <div class="lesson-structure">
                <h3><i class="fas fa-list-ol"></i> Lesson Structure (7+ slides minimum)</h3>
                <div class="slide-list">
                    <div class="slide-item">
                        <h4>Slide 1: Warm-up</h4>
                        <p>Energy demonstration, collision observation, or stored energy exploration</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 2: Learning Objectives</h4>
                        <p>Energy transformation, stored energy, and force-related learning goals</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 3: Vocabulary</h4>
                        <p>Stored energy, conversion, chemical energy, electrical energy, light energy, sound energy, heat energy</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 4: Content Introduction</h4>
                        <p>Basic energy forms, stored energy concepts, and energy transfer</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 5: Content Deep Dive</h4>
                        <p>Complex energy transformations, chemical reactions, and simple machines</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 6: Content Application</h4>
                        <p>Real-world energy applications, circuit design, and energy calculations</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 7: Digital Citizenship/Lab Cleanup</h4>
                        <p>Energy research, data analysis, digital tools, or lab cleanup procedures</p>
                    </div>
                </div>
            </div>

            <div class="resources-grid">
                <div class="resource-card">
                    <h4><i class="fas fa-video"></i> Embedded Videos</h4>
                    <ul>
                        <li>Bowling Ball Collision Investigation</li>
                        <li>Marbles Setup and Collision Demo</li>
                        <li>Energy Transfer in Collisions</li>
                        <li>Simple Machines in Action</li>
                        <li>Electric Circuit Building</li>
                        <li>Force and Motion Demonstrations</li>
                        <li>Tornado and Lightning Energy</li>
                        <li>Chemical Reaction Demonstrations</li>
                    </ul>
                </div>
                <div class="resource-card">
                    <h4><i class="fas fa-flask"></i> Hands-On Labs</h4>
                    <ul>
                        <li>Ball Collision Investigation</li>
                        <li>Friction Challenge Ramp Design</li>
                        <li>Pulley Contest Simple Machine</li>
                        <li>Domino Chain Force Transfer</li>
                        <li>Electric Circuit Building</li>
                        <li>Magnetism and Force Exploration</li>
                        <li>Energy Transformation Drawing Game</li>
                        <li>Chemical Reaction Observations</li>
                    </ul>
                </div>
                <div class="resource-card">
                    <h4><i class="fas fa-gamepad"></i> Interactive Activities</h4>
                    <ul>
                        <li>Crossword Puzzle - Using Stored Energy</li>
                        <li>Energy Transfer Simulations</li>
                        <li>Circuit Designer Game</li>
                        <li>Force and Motion Simulator</li>
                        <li>Science Art Light Switch Plate</li>
                        <li>Concept Attainment Quizzes</li>
                        <li>Energy Drawing Challenge</li>
                        <li>Chemical Reaction Identification</li>
                    </ul>
                </div>
                <div class="resource-card">
                    <h4><i class="fas fa-book"></i> Reading & Math</h4>
                    <ul>
                        <li>Reading Science: A Wild Weather Day (3 Lexile levels)</li>
                        <li>Math Connections: Animal Calorie Needs</li>
                        <li>Math Connections: Energy Cost Analysis</li>
                        <li>Books on Chemical Changes</li>
                        <li>Books on States of Matter</li>
                        <li>What's Your Sign: Chemical Reactions</li>
                        <li>Career Connections: Energy Engineers</li>
                        <li>Parent/Caregiver Guide</li>
                    </ul>
                </div>
            </div>

            <div class="assessment-overview">
                <h3><i class="fas fa-clipboard-check"></i> Comprehensive Assessments</h3>
                <div class="assessment-grid">
                    <div class="assessment-item">
                        <h4>Claim-Evidence-Reasoning</h4>
                        <p>Battery-powered toy scenario with scientific reasoning</p>
                    </div>
                    <div class="assessment-item">
                        <h4>Open-Ended Response</h4>
                        <p>Flashlight mechanics, battery energy, car energy systems</p>
                    </div>
                    <div class="assessment-item">
                        <h4>Multiple Choice</h4>
                        <p>Oil lamp costs, solar energy, butane lighter mechanics, coal types, battery energy</p>
                    </div>
                    <div class="assessment-item">
                        <h4>Math Connections</h4>
                        <p>Animal calorie calculations, energy cost analysis, efficiency comparisons</p>
                    </div>
                </div>
            </div>
            </div>
        </div>

        <!-- Bundle 4 -->
        <div class="bundle-section">
            <div class="bundle-header">
                <div class="bundle-icon">
                    <i class="fas fa-cogs"></i>
                </div>
                <div class="bundle-info">
                    <h2>Bundle 4: Engineering & Design</h2>
                    <p>Engineering Design • 8-9 weeks • March-May 2026</p>
                </div>
            </div>

            <div class="lesson-structure">
                <h3><i class="fas fa-list-ol"></i> Lesson Structure (7+ slides minimum)</h3>
                <div class="slide-list">
                    <div class="slide-item">
                        <h4>Slide 1: Warm-up</h4>
                        <p>Engineering challenge or design problem</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 2: Learning Objectives</h4>
                        <p>Engineering design process goals</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 3: Vocabulary</h4>
                        <p>Engineering and design terminology</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 4: Content Introduction</h4>
                        <p>Basic engineering design concepts</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 5: Content Deep Dive</h4>
                        <p>Advanced design thinking processes</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 6: Content Application</h4>
                        <p>Real-world engineering challenges</p>
                    </div>
                    <div class="slide-item">
                        <h4>Slide 7: Digital Citizenship</h4>
                        <p>Digital design tools and collaboration</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gemini AI Assistant Section -->
        <div class="collapsible-section">
            <div class="section-header" onclick="toggleSection('gemini')">
                <h2><i class="fas fa-robot"></i> Gemini AI Assistant</h2>
                <p>Ask questions about the STEMscopes curriculum, get teaching support, and explore science concepts</p>
                <div class="toggle-indicator">
                    <i class="fas fa-chevron-down" id="gemini-chevron"></i>
                </div>
            </div>
            <div class="section-content" id="gemini-content">
            
            <div class="gemini-container">
                <div class="gemini-categories">
                    <h3>Curriculum Categories</h3>
                    <div class="category-grid">
                        <div class="category-card" onclick="selectCategory('vocabulary')">
                            <i class="fas fa-book"></i>
                            <h4>Vocabulary</h4>
                            <p>Science terms and definitions</p>
                        </div>
                        <div class="category-card" onclick="selectCategory('animals')">
                            <i class="fas fa-paw"></i>
                            <h4>Animals</h4>
                            <p>Animal adaptations and behaviors</p>
                        </div>
                        <div class="category-card" onclick="selectCategory('plants')">
                            <i class="fas fa-seedling"></i>
                            <h4>Plants</h4>
                            <p>Plant structures and life cycles</p>
                        </div>
                        <div class="category-card" onclick="selectCategory('earth')">
                            <i class="fas fa-globe"></i>
                            <h4>Earth Science</h4>
                            <p>Rocks, weather, and Earth systems</p>
                        </div>
                        <div class="category-card" onclick="selectCategory('energy')">
                            <i class="fas fa-bolt"></i>
                            <h4>Energy & Forces</h4>
                            <p>Simple machines and energy transfer</p>
                        </div>
                        <div class="category-card" onclick="selectCategory('engineering')">
                            <i class="fas fa-cogs"></i>
                            <h4>Engineering</h4>
                            <p>Design process and problem solving</p>
                        </div>
                    </div>
                </div>
                
                <div class="gemini-chat">
                    <div id="gemini-messages" class="chat-messages">
                        <div class="message bot-message">
                            <i class="fas fa-robot"></i>
                            <span>Hi! I'm your STEMscopes AI assistant. Select a category above to ask curriculum-specific questions!</span>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="gemini-input" placeholder="Ask about the STEMscopes curriculum..." maxlength="500">
                        <button id="gemini-send" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
            </div>
        </div>

        <!-- Integrated ClassDojo & Veracross Section -->
        <div class="collapsible-section">
            <div class="section-header" onclick="toggleSection('management')">
                <h2><i class="fas fa-chalkboard-teacher"></i> Student Management & Grading</h2>
                <p>Integrated ClassDojo and Veracross functionality for seamless classroom management</p>
                <div class="toggle-indicator">
                    <i class="fas fa-chevron-down" id="management-chevron"></i>
                </div>
            </div>
            <div class="section-content" id="management-content">
            
            <div class="tools-tabs">
                <button class="tab-btn active" onclick="switchTab('classdojo')">
                    <i class="fas fa-smile"></i> ClassDojo
                </button>
                <button class="tab-btn" onclick="switchTab('veracross')">
                    <i class="fas fa-graduation-cap"></i> Veracross
                </button>
            </div>

            <!-- ClassDojo Tab -->
            <div id="classdojo-tab" class="tab-content active">
                <div class="classdojo-integration">
                    <div class="integration-header">
                        <h3><i class="fas fa-smile"></i> ClassDojo Integration</h3>
                        <p>Access the full ClassDojo mini-site for complete classroom management</p>
                    </div>
                    
                    <div class="integration-content">
                        <div class="classdojo-preview">
                            <div class="preview-header">
                                <div class="classdojo-logo">
                                    <i class="fas fa-smile"></i>
                                </div>
                                <h4>STEM Class - 4th Grade</h4>
                                <p>22 Students • 5 Active Skills</p>
                            </div>
                            
                            <div class="preview-stats">
                                <div class="stat-item">
                                    <span class="stat-number">1,247</span>
                                    <span class="stat-label">Points Awarded</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">12</span>
                                    <span class="stat-label">Day Streak</span>
                                </div>
                            </div>
                            
                            <div class="preview-students">
                                <div class="student-preview">
                                    <span class="student-avatar">🦊</span>
                                    <span class="student-name">Alex Johnson</span>
                                    <span class="student-points">+15</span>
                                </div>
                                <div class="student-preview">
                                    <span class="student-avatar">🐰</span>
                                    <span class="student-name">Emma Davis</span>
                                    <span class="student-points">+22</span>
                                </div>
                                <div class="student-preview">
                                    <span class="student-avatar">🐻</span>
                                    <span class="student-name">Marcus Wilson</span>
                                    <span class="student-points">+8</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="integration-actions">
                            <button class="btn-primary" onclick="window.open('classdojo-mini.html', '_blank')">
                                <i class="fas fa-external-link-alt"></i> Open ClassDojo Mini
                            </button>
                            <button class="btn-secondary" onclick="showClassDojoFeatures()">
                                <i class="fas fa-info-circle"></i> Learn More
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Veracross Tab -->
            <div id="veracross-tab" class="tab-content">
                <div class="veracross-dashboard">
                    <div class="veracross-header">
                        <h3><i class="fas fa-graduation-cap"></i> Veracross Integration</h3>
                        <div class="veracross-actions">
                            <button class="btn-primary" onclick="openVeracrossModal('grades')">
                                <i class="fas fa-chart-line"></i> View Grades
                            </button>
                            <button class="btn-secondary" onclick="openVeracrossModal('attendance')">
                                <i class="fas fa-calendar-check"></i> Attendance
                            </button>
                        </div>
                    </div>
                    
                    <div class="gradebook-overview">
                        <div class="gradebook-card">
                            <h4>Current Assignment</h4>
                            <p>Plant Structures Quiz</p>
                            <div class="grade-stats">
                                <span class="stat">Average: 87%</span>
                                <span class="stat">Completed: 18/22</span>
                            </div>
                        </div>
                        
                        <div class="gradebook-card">
                            <h4>Recent Grades</h4>
                            <div class="recent-grades">
                                <div class="grade-item">
                                    <span>Ecosystem Project</span>
                                    <span class="grade A">A</span>
                                </div>
                                <div class="grade-item">
                                    <span>Vocabulary Test</span>
                                    <span class="grade B">B+</span>
                                </div>
                                <div class="grade-item">
                                    <span>Lab Report</span>
                                    <span class="grade A">A-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="attendance-summary">
                        <h4>Today's Attendance</h4>
                        <div class="attendance-stats">
                            <div class="attendance-item present">
                                <i class="fas fa-check-circle"></i>
                                <span>Present: 20</span>
                            </div>
                            <div class="attendance-item absent">
                                <i class="fas fa-times-circle"></i>
                                <span>Absent: 2</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            </div>
        </div>

        <!-- AI Tools Section -->
        <div class="ai-tools-section">
            <h2><i class="fas fa-robot"></i> AI-Powered Teaching Tools</h2>
            <div class="ai-tools-grid">
                <div class="ai-tool-card" onclick="openAIToolWithBundle('lesson-plans')">
                    <div class="ai-tool-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <h3>Lesson Plan Generator</h3>
                    <p>Generate detailed lesson plans with AI assistance</p>
                </div>
                <div class="ai-tool-card" onclick="openAITool('rubrics')">
                    <div class="ai-tool-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <h3>Rubric Creator</h3>
                    <p>Create comprehensive assessment rubrics</p>
                </div>
                <div class="ai-tool-card" onclick="openAITool('image-creator')">
                    <div class="ai-tool-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <h3>Image Creator</h3>
                    <p>Generate custom images for lessons and presentations</p>
                </div>
                <div class="ai-tool-card" onclick="openAITool('newsletters')">
                    <div class="ai-tool-icon">
                        <i class="fas fa-newspaper"></i>
                    </div>
                    <h3>Newsletter Generator</h3>
                    <p>Generate parent newsletters and updates</p>
                </div>
                <div class="ai-tool-card" onclick="openAIToolWithBundle('assessments')">
                    <div class="ai-tool-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <h3>Assessment Builder</h3>
                    <p>Create quizzes and assessments automatically</p>
                </div>
                <div class="ai-tool-card" onclick="openAITool('activities')">
                    <div class="ai-tool-icon">
                        <i class="fas fa-puzzle-piece"></i>
                    </div>
                    <h3>Activity Generator</h3>
                    <p>Create engaging classroom activities and games</p>
                </div>
            </div>
        </div>

        <div class="digital-tools">
            <h2><i class="fas fa-tools"></i> Digital Tools & Resources</h2>
            
            <div class="digital-tools-section">
                <h3><i class="fas fa-tools"></i> Digital Tools & Services</h3>
                <div class="digital-tools-grid">
                    <a href="https://app.acceleratelearning.com/scopes/18553/elements/818043" target="_blank" class="digital-tool-link">
                        <i class="fas fa-microscope"></i>
                        <span>STEMscopes</span>
                    </a>
                    <a href="https://drive.google.com" target="_blank" class="digital-tool-link">
                        <i class="fab fa-google-drive"></i>
                        <span>Google Drive</span>
                    </a>
                    <a href="https://gemini.google.com" target="_blank" class="digital-tool-link">
                        <i class="fas fa-robot"></i>
                        <span>Google Gemini</span>
                    </a>
                    <a href="https://classroom.google.com" target="_blank" class="digital-tool-link">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>Google Classroom</span>
                    </a>
                    <a href="https://chat.openai.com" target="_blank" class="digital-tool-link">
                        <i class="fas fa-comments"></i>
                        <span>ChatGPT</span>
                    </a>
                    <a href="https://phet.colorado.edu" target="_blank" class="digital-tool-link">
                        <i class="fas fa-flask"></i>
                        <span>PhET Simulations</span>
                    </a>
                    <a href="https://www.brainpop.com/science" target="_blank" class="digital-tool-link">
                        <i class="fas fa-brain"></i>
                        <span>BrainPOP Science</span>
                    </a>
                    <a href="https://www.khanacademy.org/science" target="_blank" class="digital-tool-link">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Khan Academy</span>
                    </a>
                </div>
            </div>
            <div class="tools-grid">
                <div class="tool-item" onclick="openTool('vocabulary-cards')">
                    <i class="fas fa-credit-card"></i>
                    <h4>Vocabulary Cards</h4>
                    <p>Interactive digital flashcards for all 4 bundles + mixed practice</p>
                </div>
                <div class="tool-item" onclick="openTool('assessment-tools')">
                    <i class="fas fa-clipboard-check"></i>
                    <h4>Assessment Tools</h4>
                    <p>CER assessments, multiple choice, and open-ended responses</p>
                </div>
                <div class="tool-item" onclick="openTool('extension-activities')">
                    <i class="fas fa-lightbulb"></i>
                    <h4>Extension Activities</h4>
                    <p>Enrichment activities and science art projects</p>
                </div>
                <div class="tool-item" onclick="openTool('interactive-charts')">
                    <i class="fas fa-chart-bar"></i>
                    <h4>Interactive Charts</h4>
                    <p>Dynamic data visualization tools with bar, pie, and line charts</p>
                </div>
                <div class="tool-item" onclick="openTool('food-chain-builder')">
                    <i class="fas fa-link"></i>
                    <h4>Food Chain Builder</h4>
                    <p>Digital ecosystem simulation with drag-and-drop organisms</p>
                </div>
                <div class="tool-item" onclick="openTool('virtual-labs')">
                    <i class="fas fa-microscope"></i>
                    <h4>Virtual Labs</h4>
                    <p>Interactive online science experiments and simulations</p>
                </div>
                <div class="tool-item" onclick="openTool('assessment-tools')">
                    <i class="fas fa-question-circle"></i>
                    <h4>Assessment Tools</h4>
                    <p>Digital quizzes and progress tracking</p>
                </div>
                <div class="tool-item" onclick="openTool('collaboration-tools')">
                    <i class="fas fa-users"></i>
                    <h4>Collaboration Tools</h4>
                    <p>Group project management with planning, brainstorming, and task tracking</p>
                </div>
                <div class="tool-item" onclick="openTool('bundle-video-resources')">
                    <i class="fas fa-video"></i>
                    <h4>Bundle Video Resources</h4>
                    <p>Educational videos, worksheets, and graphic organizers for each bundle</p>
                </div>
                <div class="tool-item" onclick="openTool('interactive-games')">
                    <i class="fas fa-gamepad"></i>
                    <h4>Interactive STEM Games</h4>
                    <p>Engaging educational games for all 4 bundles with progress tracking</p>
                </div>
                <div class="tool-item" onclick="openTool('comprehensive-assessments')">
                    <i class="fas fa-clipboard-list"></i>
                    <h4>Comprehensive Assessments</h4>
                    <p>CER, multiple choice, open-ended, and math connection assessments</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bundle Content -->
    <div id="bundleContent" style="display: none;">
        <!-- Bundle content will be dynamically loaded here -->
    </div>

    <!-- Tool Modal -->
    <div id="toolModal" class="tool-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Tool</h2>
                <button class="close-btn" onclick="closeTool()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <iframe id="toolFrame" src="" frameborder="0"></iframe>
            </div>
        </div>
    </div>

    <style>
        .tool-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 15px;
            width: 95%;
            height: 90%;
            max-width: 1400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .modal-body {
            flex: 1;
            padding: 0;
            border-radius: 0 0 15px 15px;
            overflow: hidden;
        }

        .modal-body iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0 0 15px 15px;
        }

        .tool-modal.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Bundle Content Styles */
        .bundle-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
        }

        .bundle-header .back-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .bundle-header .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* Collapsible Bundle Styles */
        .bundle-header.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bundle-header.clickable:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .bundle-toggle {
            margin-left: auto;
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .bundle-toggle.rotated {
            transform: rotate(180deg);
        }

        .bundle-content {
            margin-top: -20px;
            padding: 0 25px 25px 25px;
            background: white;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .bundle-title {
            text-align: center;
        }

        .bundle-title h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .bundle-title p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .bundle-sections {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .bundle-section {
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: #f8f9fa;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .section-header:hover {
            background: #e9ecef;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title i {
            font-size: 1.5em;
            color: #667eea;
        }

        .section-title h3 {
            margin: 0;
            color: #333;
        }

        .section-arrow {
            transition: transform 0.3s ease;
            color: #666;
        }

        .section-content {
            display: none;
            padding: 0;
        }

        .section-item {
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .section-item:hover {
            background: #f8f9fa;
        }

        .section-item:last-child {
            border-bottom: none;
        }

        .item-icon {
            font-size: 1.5em;
        }

        .item-name {
            flex: 1;
            color: #333;
            font-weight: 500;
        }

        .item-arrow {
            color: #666;
            transition: transform 0.3s ease;
        }

        .section-item:hover .item-arrow {
            transform: translateX(5px);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
    </style>

    <script>
        // Tool navigation functions
        function openTool(toolName) {
            const modal = document.getElementById('toolModal');
            const title = document.getElementById('modalTitle');
            const frame = document.getElementById('toolFrame');
            
            const toolUrls = {
                'vocabulary-cards': 'vocabulary-cards.html',
                'assessment-tools': 'assessment-tools.html',
                'extension-activities': 'extension-activities.html',
                'interactive-charts': 'interactive-charts.html',
                'food-chain-builder': 'food-chain-builder.html',
                'collaboration-tools': 'collaboration-tools.html',
                'bundle-video-resources': 'video-resources.html',
                'virtual-labs': 'virtual-labs.html',
                'interactive-games': 'interactive-games.html',
                'comprehensive-assessments': 'comprehensive-assessments.html'
            };
            
            const toolTitles = {
                'vocabulary-cards': 'Vocabulary Cards',
                'assessment-tools': 'Assessment Tools',
                'extension-activities': 'Extension Activities',
                'interactive-charts': 'Interactive Charts',
                'food-chain-builder': 'Food Chain Builder',
                'collaboration-tools': 'Collaboration Tools',
                'bundle-video-resources': 'Educational Video Resources',
                'virtual-labs': 'Virtual Labs',
                'interactive-games': 'Interactive STEM Games',
                'comprehensive-assessments': 'Comprehensive Assessments'
            };
            
            title.textContent = toolTitles[toolName];
            frame.src = toolUrls[toolName];
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeTool() {
            const modal = document.getElementById('toolModal');
            const frame = document.getElementById('toolFrame');
            
            modal.classList.remove('active');
            frame.src = '';
            document.body.style.overflow = 'auto';
        }
        
        // Close modal when clicking outside
        document.getElementById('toolModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeTool();
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeTool();
            }
        });
        
        // Function to open bundle lessons
        function openBundle(bundleId) {
            // Hide main content and show bundle-specific content
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('bundleContent').style.display = 'block';
            
            // Load bundle-specific content
            loadBundleContent(bundleId);
        }

        function toggleBundle(bundleId) {
            const content = document.getElementById(bundleId + '-content');
            const chevron = document.getElementById(bundleId + '-chevron');
            
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                chevron.classList.add('rotated');
            } else {
                content.style.display = 'none';
                chevron.classList.remove('rotated');
            }
        }

        function loadBundleContent(bundleId) {
            const bundleContent = document.getElementById('bundleContent');
            const bundleData = getBundleData(bundleId);
            
            bundleContent.innerHTML = `
                <div class="bundle-header">
                    <button class="back-btn" onclick="showMainContent()">
                        <i class="fas fa-arrow-left"></i> Back to Timeline
                    </button>
                    <div class="bundle-title">
                        <h1>${bundleData.title}</h1>
                        <p>${bundleData.subtitle}</p>
                    </div>
                </div>
                <div class="bundle-sections">
                    ${generateBundleSections(bundleData)}
                </div>
            `;
        }

        function getBundleData(bundleId) {
            const bundles = {
                'bundle1': {
                    title: 'Bundle 1: Organism Structures & Behavior',
                    subtitle: 'Life Science • 8-9 weeks • September-October 2025',
                    icon: '🌱',
                    sections: [
                        {
                            title: 'Lesson Presentations',
                            icon: 'chart-bar',
                            items: [
                                { name: '4th_Grade_STEM_Bundle1_Organism_Structures.pptx', type: 'presentation' },
                                { name: 'Bundle1_Plant_Animal_Structures_Lesson_Draft.pptx', type: 'presentation' },
                                { name: 'Bundle1_VisualEnhanced.pptx', type: 'presentation' },
                                { name: 'Plant_Structures_Interactive.pptx', type: 'presentation' },
                                { name: 'Animal_Adaptations_Complete.pptx', type: 'presentation' },
                                { name: 'Food_Chains_and_Webs.pptx', type: 'presentation' },
                                { name: 'Ecosystem_Interactions.pptx', type: 'presentation' }
                            ]
                        },
                        {
                            title: 'NGSS Documents',
                            icon: 'file-alt',
                            items: [
                                { name: 'Lesson Planning Guide Front Matter', type: 'document' },
                                { name: 'Mission Log', type: 'document' },
                                { name: 'Sample Lesson Plans', type: 'document' }
                            ]
                        },
                        {
                            title: 'Interactive Lessons',
                            icon: 'target',
                            items: [
                                { name: 'Lesson 1: Introduction to Organism Structures', type: 'lesson', id: 'lesson1' },
                                { name: 'Lesson 2: Plant Structures and Functions', type: 'lesson', id: 'lesson2' },
                                { name: 'Lesson 3: Animal Structures and Adaptations', type: 'lesson', id: 'lesson3' },
                                { name: 'Lesson 4: Plant Structure Investigation Lab', type: 'lesson', id: 'lesson4' },
                                { name: 'Lesson 5: Food Chains and Energy Flow', type: 'lesson', id: 'lesson5' },
                                { name: 'Lesson 6: Ecosystem Interactions', type: 'lesson', id: 'lesson6' },
                                { name: 'Lesson 7: Environmental Changes', type: 'lesson', id: 'lesson7' },
                                { name: 'Lesson 8: Ecosystem Investigation Lab', type: 'lesson', id: 'lesson8' },
                                { name: 'Lesson 9: Human Impact on Ecosystems', type: 'lesson', id: 'lesson9' },
                                { name: 'Lesson 10: Conservation and Protection', type: 'lesson', id: 'lesson10' },
                                { name: 'Lesson 11: Bundle 1 Review and Assessment', type: 'lesson', id: 'lesson11' },
                                { name: 'Lesson 12: Final Project - Ecosystem Model', type: 'lesson', id: 'lesson12' }
                            ]
                        },
                        {
                            title: 'Assessments & Quizzes',
                            icon: 'clipboard-check',
                            items: [
                                { name: 'Bundle 1 Vocabulary Quiz', type: 'quiz' },
                                { name: 'Structure-Function Assessment', type: 'assessment' },
                                { name: 'Plant vs Animal Comparison', type: 'activity' },
                                { name: 'Food Chain Analysis Quiz', type: 'quiz' },
                                { name: 'Ecosystem Interactions Assessment', type: 'assessment' },
                                { name: 'Environmental Impact Project', type: 'project' },
                                { name: 'Conservation Strategies Activity', type: 'activity' },
                                { name: 'Bundle 1 Final Exam', type: 'exam' }
                            ]
                        },
                        {
                            title: 'Games & Activities',
                            icon: 'gamepad',
                            items: [
                                { name: 'Vocabulary Cards - Bundle 1', type: 'game' },
                                { name: 'Food Chain Builder', type: 'game' },
                                { name: 'Structure Matching Game', type: 'game' },
                                { name: 'Ecosystem Explorer', type: 'game' },
                                { name: 'Plant vs Animal Challenge', type: 'game' },
                                { name: 'Environmental Impact Simulator', type: 'game' },
                                { name: 'Conservation Hero Quest', type: 'game' },
                                { name: 'Interactive Food Web Builder', type: 'activity' }
                            ]
                        }
                    ]
                },
                'bundle2': {
                    title: 'Bundle 2: Changes Over Time to Earth\'s Surface & Resources',
                    subtitle: 'Earth Science • 8-9 weeks • November-December 2025',
                    icon: '🏔️',
                    sections: [
                        {
                            title: 'Lesson Presentations',
                            icon: 'chart-bar',
                            items: [
                                { name: 'Bundle2_ChangesOverTimetoEarthsSurface_LessonPlanningGuide.pdf', type: 'document' },
                                { name: 'Earth_Science_Complete_Presentation.pptx', type: 'presentation' },
                                { name: 'Rocks_and_Minerals_Interactive.pptx', type: 'presentation' },
                                { name: 'Weathering_and_Erosion_Visual.pptx', type: 'presentation' },
                                { name: 'Natural_Disasters_and_Safety.pptx', type: 'presentation' },
                                { name: 'Earth_Resources_and_Conservation.pptx', type: 'presentation' }
                            ]
                        },
                        {
                            title: 'NGSS Documents',
                            icon: 'file-alt',
                            items: [
                                { name: 'Bundle2_ChangesOverTimetoEarthsSurface_LessonPlanningGuide.pdf', type: 'document' },
                                { name: 'Earth Science Assessment Materials', type: 'document' },
                                { name: 'Rock Cycle Study Guide', type: 'document' },
                                { name: 'Natural Disaster Safety Protocol', type: 'document' },
                                { name: 'Earth Resources Conservation Guide', type: 'document' }
                            ]
                        },
                        {
                            title: 'Interactive Lessons',
                            icon: 'target',
                            items: [
                                { name: 'Lesson 13: Earth\'s Layers and Structure', type: 'lesson', id: 'lesson13' },
                                { name: 'Lesson 14: Rock Cycle and Formation', type: 'lesson', id: 'lesson14' },
                                { name: 'Lesson 15: Weathering and Erosion', type: 'lesson', id: 'lesson15' },
                                { name: 'Lesson 16: Rock Investigation Lab', type: 'lesson', id: 'lesson16' },
                                { name: 'Lesson 17: Natural Disasters', type: 'lesson', id: 'lesson17' },
                                { name: 'Lesson 18: Earth\'s Resources', type: 'lesson', id: 'lesson18' },
                                { name: 'Lesson 19: Conservation and Protection', type: 'lesson', id: 'lesson19' },
                                { name: 'Lesson 20: Natural Disaster Safety Lab', type: 'lesson', id: 'lesson20' },
                                { name: 'Lesson 21: Human Impact on Earth', type: 'lesson', id: 'lesson21' },
                                { name: 'Lesson 22: Sustainable Practices', type: 'lesson', id: 'lesson22' },
                                { name: 'Lesson 23: Bundle 2 Review and Assessment', type: 'lesson', id: 'lesson23' },
                                { name: 'Lesson 24: Final Project - Earth Model', type: 'lesson', id: 'lesson24' }
                            ]
                        },
                        {
                            title: 'Assessments & Quizzes',
                            icon: 'clipboard-check',
                            items: [
                                { name: 'Natural Processes CER Assessment', type: 'assessment' },
                                { name: 'Earth Science Vocabulary Quiz', type: 'quiz' },
                                { name: 'Safety First Activity', type: 'activity' },
                                { name: 'Rock Cycle Analysis Quiz', type: 'quiz' },
                                { name: 'Weathering and Erosion Assessment', type: 'assessment' },
                                { name: 'Natural Disaster Preparedness Project', type: 'project' },
                                { name: 'Earth Resources Conservation Activity', type: 'activity' },
                                { name: 'Bundle 2 Final Exam', type: 'exam' }
                            ]
                        },
                        {
                            title: 'Games & Activities',
                            icon: 'gamepad',
                            items: [
                                { name: 'Vocabulary Cards - Bundle 2', type: 'game' },
                                { name: 'Rock Cycle Game', type: 'game' },
                                { name: 'Natural Disaster Preparedness', type: 'activity' },
                                { name: 'Earth Layer Explorer', type: 'game' },
                                { name: 'Weathering and Erosion Simulator', type: 'game' },
                                { name: 'Natural Disaster Survival Challenge', type: 'game' },
                                { name: 'Earth Resources Management', type: 'game' },
                                { name: 'Conservation Hero Earth Edition', type: 'game' }
                            ]
                        }
                    ]
                },
                'bundle3': {
                    title: 'Bundle 3: Using Energy Transformations',
                    subtitle: 'Physical Science • 6-7 weeks • January-February 2026',
                    icon: '⚡',
                    sections: [
                        {
                            title: 'Lesson Presentations',
                            icon: 'chart-bar',
                            items: [
                                { name: 'Bundle3_EnergyTransformations_Complete.pptx', type: 'presentation' },
                                { name: 'Transfer_of_Energy_in_Collision.pptx', type: 'presentation' },
                                { name: 'Energy_Forms_and_Transfer.pptx', type: 'presentation' },
                                { name: 'Simple_Machines_Interactive.pptx', type: 'presentation' },
                                { name: 'Electric_Circuits_and_Current.pptx', type: 'presentation' },
                                { name: 'Light_and_Sound_Energy.pptx', type: 'presentation' },
                                { name: 'Forces_and_Motion_Complete.pptx', type: 'presentation' },
                                { name: 'Using_Stored_Energy_Complete.pptx', type: 'presentation' }
                            ]
                        },
                        {
                            title: 'Interactive Lessons',
                            icon: 'target',
                            items: [
                                { name: 'Lesson 25: Energy Transfer in Collisions', type: 'lesson', id: 'lesson25' },
                                { name: 'Lesson 26: Forms of Energy', type: 'lesson', id: 'lesson26' },
                                { name: 'Lesson 27: Energy Transformation', type: 'lesson', id: 'lesson27' },
                                { name: 'Lesson 28: Energy Transfer Lab', type: 'lesson', id: 'lesson28' },
                                { name: 'Lesson 29: Simple Machines', type: 'lesson', id: 'lesson29' },
                                { name: 'Lesson 30: Electric Circuits', type: 'lesson', id: 'lesson30' },
                                { name: 'Lesson 31: Light and Sound Energy', type: 'lesson', id: 'lesson31' },
                                { name: 'Lesson 32: Circuit Design Lab', type: 'lesson', id: 'lesson32' },
                                { name: 'Lesson 33: Forces and Motion', type: 'lesson', id: 'lesson33' },
                                { name: 'Lesson 34: Friction and Gravity', type: 'lesson', id: 'lesson34' },
                                { name: 'Lesson 35: Magnetism and Forces', type: 'lesson', id: 'lesson35' },
                                { name: 'Lesson 36: Energy Project Lab', type: 'lesson', id: 'lesson36' }
                            ]
                        },
                        {
                            title: 'Hands-On Labs & Activities',
                            icon: 'flask',
                            items: [
                                { name: 'Guided Practice: Ball Collision Investigation', type: 'lab' },
                                { name: 'Independent Practice: Crossword Puzzle - Using Stored Energy', type: 'activity' },
                                { name: 'Kinesthetic: Suck It Up Force Experiment', type: 'lab' },
                                { name: 'Friction Challenge: Ramp Design', type: 'lab' },
                                { name: 'Pulley Contest: Simple Machine Challenge', type: 'lab' },
                                { name: 'Domino Chain: Force Transfer Demonstration', type: 'lab' },
                                { name: 'Science Art: Energy Forms Light Switch Plate', type: 'activity' },
                                { name: 'Electric Circuit Building Lab', type: 'lab' },
                                { name: 'Light and Sound Investigation', type: 'lab' },
                                { name: 'Magnetism and Force Exploration', type: 'lab' },
                                { name: 'Energy Transformation Drawing Game', type: 'activity' }
                            ]
                        },
                        {
                            title: 'Assessments & Quizzes',
                            icon: 'clipboard-check',
                            items: [
                                { name: 'Concept Attainment Quiz: Energy Vocabulary', type: 'quiz' },
                                { name: 'Claim-Evidence-Reasoning Assessment', type: 'assessment' },
                                { name: 'Open-Ended Response Assessment', type: 'assessment' },
                                { name: 'Multiple Choice Assessment', type: 'quiz' },
                                { name: 'Math Connections A: Animal Energy Needs', type: 'assessment' },
                                { name: 'Math Connections B: Calorie Calculations', type: 'assessment' },
                                { name: 'Math Connections C: Energy Cost Analysis', type: 'assessment' },
                                { name: 'Bundle 3 Final Exam', type: 'assessment' },
                                { name: 'Energy Transformation CER', type: 'assessment' },
                                { name: 'Circuit Design Rubric', type: 'rubric' },
                                { name: 'Lab Report Template', type: 'template' }
                            ]
                        },
                        {
                            title: 'Reading Science & Literacy',
                            icon: 'book-open',
                            items: [
                                { name: 'Reading Science A: A Wild Weather Day (Lexile 630L)', type: 'reading' },
                                { name: 'Reading Science B: A Wild Weather Day (Lexile 710L)', type: 'reading' },
                                { name: 'Reading Science C: A Wild Weather Day (Lexile 790L)', type: 'reading' },
                                { name: 'Reading Comprehension Questions', type: 'assessment' },
                                { name: 'Energy Vocabulary in Context', type: 'reading' },
                                { name: 'Tornado Safety and Energy', type: 'reading' },
                                { name: 'Chemical Energy in Batteries', type: 'reading' },
                                { name: 'Lightning and Electrical Energy', type: 'reading' }
                            ]
                        },
                        {
                            title: 'Math Connections',
                            icon: 'calculator',
                            items: [
                                { name: 'Animal Calorie Needs Word Problems', type: 'math' },
                                { name: 'Blue Whale Energy Calculations', type: 'math' },
                                { name: 'Human Daily Calorie Requirements', type: 'math' },
                                { name: 'Energy Cost Analysis Tables', type: 'math' },
                                { name: 'Oil Lamp Efficiency Calculations', type: 'math' },
                                { name: 'Coal Type Cost Comparisons', type: 'math' },
                                { name: 'Battery Energy Duration Problems', type: 'math' },
                                { name: 'Speed and Energy Relationship', type: 'math' }
                            ]
                        },
                        {
                            title: 'Games & Interactive Activities',
                            icon: 'gamepad',
                            items: [
                                { name: 'Vocabulary Cards - Bundle 3', type: 'game' },
                                { name: 'Energy Transfer Game', type: 'game' },
                                { name: 'Simple Machines Builder', type: 'game' },
                                { name: 'Circuit Designer', type: 'game' },
                                { name: 'Force and Motion Simulator', type: 'game' },
                                { name: 'Energy Transformation Puzzle', type: 'game' },
                                { name: 'Collision Physics Game', type: 'game' },
                                { name: 'Electric Current Flow Game', type: 'game' },
                                { name: 'Energy Drawing Challenge', type: 'game' },
                                { name: 'Chemical Reaction Identification', type: 'game' }
                            ]
                        },
                        {
                            title: 'Extension Activities',
                            icon: 'puzzle-piece',
                            items: [
                                { name: 'Books on Topic: Chemical Changes', type: 'resource' },
                                { name: 'Books on Topic: Physical and Chemical Properties', type: 'resource' },
                                { name: 'Books on Topic: States of Matter', type: 'resource' },
                                { name: 'Books on Topic: The Way Science Works', type: 'resource' },
                                { name: 'What\'s Your Sign: Chemical Reactions', type: 'activity' },
                                { name: 'Water Purification Chemical Process', type: 'activity' },
                                { name: 'Photosynthesis and Respiration', type: 'activity' },
                                { name: 'Marine Flare Chemical Reactions', type: 'activity' },
                                { name: 'Autumn Leaves Color Changes', type: 'activity' },
                                { name: 'Digestion and Energy Release', type: 'activity' },
                                { name: 'Rusting Iron Chemical Change', type: 'activity' },
                                { name: 'Greenhouse Gases and Fossil Fuels', type: 'activity' },
                                { name: 'Invite Local Perspective: Chemical Engineer', type: 'activity' },
                                { name: 'Career Connections: Energy Engineers', type: 'resource' },
                                { name: 'Parent/Caregiver Guide', type: 'resource' }
                            ]
                        },
                        {
                            title: 'Digital Resources',
                            icon: 'laptop',
                            items: [
                                { name: 'Picture Vocabulary: Energy Terms', type: 'digital' },
                                { name: 'Linking Literacy: Energy Reading', type: 'digital' },
                                { name: 'Concept Review Game: Vocabulary Baseball', type: 'digital' },
                                { name: 'Interactive Energy Simulations', type: 'digital' },
                                { name: 'Virtual Circuit Builder', type: 'digital' },
                                { name: 'Energy Transformation Animations', type: 'digital' },
                                { name: 'Force and Motion Videos', type: 'digital' },
                                { name: 'Assessment Tools and Rubrics', type: 'digital' },
                                { name: 'Tornado and Lightning Videos', type: 'digital' },
                                { name: 'Chemical Reaction Demonstrations', type: 'digital' }
                            ]
                        }
                    ]
                },
                'bundle4': {
                    title: 'Bundle 4: Engineering & Design',
                    subtitle: 'Engineering • 5-6 weeks • March-May 2026',
                    icon: '🔧',
                    sections: [
                        {
                            title: 'Interactive Lessons',
                            icon: 'target',
                            items: [
                                { name: 'Lesson 37: Introduction to Engineering', type: 'lesson', id: 'lesson37' },
                                { name: 'Lesson 38: Design Process', type: 'lesson', id: 'lesson38' },
                                { name: 'Lesson 39: Problem Solving', type: 'lesson', id: 'lesson39' },
                                { name: 'Lesson 40: Engineering Design Lab', type: 'lesson', id: 'lesson40' }
                            ]
                        },
                        {
                            title: 'Assessments & Quizzes',
                            icon: 'clipboard-check',
                            items: [
                                { name: 'Engineering Vocabulary Quiz', type: 'quiz' },
                                { name: 'Design Process Assessment', type: 'assessment' },
                                { name: 'Problem Solving Challenge', type: 'activity' }
                            ]
                        },
                        {
                            title: 'Games & Activities',
                            icon: 'gamepad',
                            items: [
                                { name: 'Vocabulary Cards - Bundle 4', type: 'game' },
                                { name: 'Engineering Design Game', type: 'game' },
                                { name: 'Problem Solving Simulator', type: 'game' }
                            ]
                        }
                    ]
                }
            };
            
            return bundles[bundleId] || bundles['bundle1'];
        }

        function generateBundleSections(bundleData) {
            return bundleData.sections.map(section => `
                <div class="bundle-section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-${section.icon}"></i>
                            <h3>${section.title}</h3>
                        </div>
                        <i class="fas fa-chevron-down section-arrow"></i>
                    </div>
                    <div class="section-content">
                        ${section.items.map(item => `
                            <div class="section-item" onclick="openItem('${item.type}', '${item.id || item.name}')">
                                <div class="item-icon">
                                    ${getItemIcon(item.type)}
                                </div>
                                <div class="item-name">${item.name}</div>
                                <i class="fas fa-arrow-right item-arrow"></i>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function getItemIcon(type) {
            const icons = {
                'presentation': '📊',
                'document': '📄',
                'lesson': '🎯',
                'quiz': '❓',
                'assessment': '📝',
                'activity': '🎨',
                'game': '🎮'
            };
            return icons[type] || '📄';
        }

        function toggleSection(header) {
            const section = header.parentElement;
            const content = section.querySelector('.section-content');
            const arrow = header.querySelector('.section-arrow');
            
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                arrow.style.transform = 'rotate(180deg)';
            } else {
                content.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function openItem(type, id) {
            switch(type) {
                case 'lesson':
                    window.open(`interactive-teacher-portal.html#${id}`, '_blank');
                    break;
                case 'game':
                    if (id.includes('Vocabulary Cards')) {
                        openTool('vocabulary-cards');
                    } else if (id.includes('Food Chain')) {
                        openTool('food-chain-builder');
                    }
                    break;
                case 'assessment':
                    openTool('assessment-tools');
                    break;
                case 'activity':
                    openTool('extension-activities');
                    break;
                default:
                    alert(`Opening ${type}: ${id}`);
            }
        }

        function showMainContent() {
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('bundleContent').style.display = 'none';
        }

        // What's Next functionality
        let currentProgress = {
            bundle: null,
            lesson: null,
            slide: 0,
            completed: false
        };

        // Load progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('teacherProgress');
            if (saved) {
                currentProgress = JSON.parse(saved);
                updateWhatsNext();
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            localStorage.setItem('teacherProgress', JSON.stringify(currentProgress));
        }

        // Update What's Next display
        function updateWhatsNext() {
            const titleEl = document.getElementById('nextLessonTitle');
            const descEl = document.getElementById('nextLessonDescription');
            const progressEl = document.getElementById('progressFill');
            const progressTextEl = document.getElementById('progressText');
            const continueBtn = document.getElementById('continueLessonBtn');

            if (!currentProgress.bundle) {
                titleEl.textContent = 'Ready to Start Your Journey!';
                descEl.textContent = 'Select a lesson to begin tracking your progress through the curriculum.';
                progressEl.style.width = '0%';
                progressTextEl.textContent = '0% Complete';
                continueBtn.style.display = 'none';
                return;
            }

            const bundleNames = {
                'bundle1': 'Bundle 1: Organisms and Their Environment',
                'bundle2': 'Bundle 2: Earth and Space Systems',
                'bundle3': 'Bundle 3: Energy and Forces',
                'bundle4': 'Bundle 4: Engineering and Design'
            };

            const lessonNames = {
                'bundle1': ['Lesson 1: Structure and Function', 'Lesson 2: Plant Adaptations', 'Lesson 3: Animal Adaptations', 'Lesson 4: Lab - Plant Investigation', 'Lesson 5: Ecosystems', 'Lesson 6: Food Chains', 'Lesson 7: Environmental Changes', 'Lesson 8: Lab - Ecosystem Model', 'Lesson 9: Human Impact', 'Lesson 10: Conservation', 'Lesson 11: Assessment', 'Lesson 12: Lab - Final Project'],
                'bundle2': ['Lesson 1: Earth\'s Layers', 'Lesson 2: Rock Cycle', 'Lesson 3: Weathering and Erosion', 'Lesson 4: Lab - Rock Investigation', 'Lesson 5: Water Cycle', 'Lesson 6: Weather Patterns', 'Lesson 7: Climate Zones', 'Lesson 8: Lab - Weather Station', 'Lesson 9: Natural Disasters', 'Lesson 10: Earth\'s Resources', 'Lesson 11: Assessment', 'Lesson 12: Lab - Earth Model'],
                'bundle3': ['Lesson 1: Forms of Energy', 'Lesson 2: Energy Transfer', 'Lesson 3: Simple Machines', 'Lesson 4: Lab - Machine Building', 'Lesson 5: Electricity', 'Lesson 6: Circuits', 'Lesson 7: Light and Sound', 'Lesson 8: Lab - Circuit Design', 'Lesson 9: Forces and Motion', 'Lesson 10: Magnetism', 'Lesson 11: Assessment', 'Lesson 12: Lab - Energy Project'],
                'bundle4': ['Lesson 1: Engineering Process', 'Lesson 2: Design Thinking', 'Lesson 3: Materials and Properties', 'Lesson 4: Lab - Material Testing', 'Lesson 5: Problem Solving', 'Lesson 6: Prototyping', 'Lesson 7: Testing and Iteration', 'Lesson 8: Lab - Design Challenge', 'Lesson 9: Technology and Society', 'Lesson 10: Innovation', 'Lesson 11: Assessment', 'Lesson 12: Lab - Final Design']
            };

            const currentLesson = currentProgress.lesson || 0;
            const totalLessons = 12;
            const progressPercent = Math.round((currentLesson / totalLessons) * 100);

            titleEl.textContent = bundleNames[currentProgress.bundle] || 'Current Bundle';
            descEl.textContent = currentLesson < totalLessons ? 
                `Next: ${lessonNames[currentProgress.bundle][currentLesson]}` : 
                'Congratulations! You\'ve completed this bundle!';
            
            progressEl.style.width = `${progressPercent}%`;
            progressTextEl.textContent = `${progressPercent}% Complete`;

            if (currentLesson < totalLessons) {
                continueBtn.style.display = 'flex';
                continueBtn.onclick = () => continueLesson();
            } else {
                continueBtn.style.display = 'none';
            }
        }

        // Continue current lesson
        function continueLesson() {
            if (currentProgress.bundle && currentProgress.lesson !== null) {
                window.location.href = `interactive-teacher-portal.html#${currentProgress.bundle}&lesson=${currentProgress.lesson}&slide=${currentProgress.slide}`;
            }
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset your progress? This cannot be undone.')) {
                currentProgress = { bundle: null, lesson: null, slide: 0, completed: false };
                saveProgress();
                updateWhatsNext();
            }
        }

        // Update progress (called from interactive portal)
        function updateProgress(bundle, lesson, slide, completed = false) {
            currentProgress = { bundle, lesson, slide, completed };
            saveProgress();
            updateWhatsNext();
        }

        // AI Tools functionality
        function openAIToolWithBundle(toolType) {
            // First show bundle selection modal
            const bundleModal = document.createElement('div');
            bundleModal.className = 'modal-overlay';
            bundleModal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-layer-group"></i> Select Bundle for ${toolType === 'lesson-plans' ? 'Lesson Plan Generator' : 'Assessment Builder'}</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Choose which bundle you want to create content for:</p>
                        <div class="bundle-selection-grid">
                            <div class="bundle-option" onclick="selectBundleForAI('bundle1', '${toolType}')">
                                <div class="bundle-option-icon">🌱</div>
                                <h4>Bundle 1: Organism Structures</h4>
                                <p>Life Science • Plant & Animal Structures</p>
                            </div>
                            <div class="bundle-option" onclick="selectBundleForAI('bundle2', '${toolType}')">
                                <div class="bundle-option-icon">🏔️</div>
                                <h4>Bundle 2: Earth's Surface</h4>
                                <p>Earth Science • Rocks, Weathering, Resources</p>
                            </div>
                            <div class="bundle-option" onclick="selectBundleForAI('bundle3', '${toolType}')">
                                <div class="bundle-option-icon">⚡</div>
                                <h4>Bundle 3: Energy & Forces</h4>
                                <p>Physical Science • Energy, Motion, Forces</p>
                            </div>
                            <div class="bundle-option" onclick="selectBundleForAI('bundle4', '${toolType}')">
                                <div class="bundle-option-icon">🔧</div>
                                <h4>Bundle 4: Engineering & Design</h4>
                                <p>Engineering • Problem Solving, Design Process</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(bundleModal);
        }

        function selectBundleForAI(bundleId, toolType) {
            closeModal();
            // Store selected bundle for the AI tool
            localStorage.setItem('selectedBundle', bundleId);
            // Open the AI tool with bundle context
            openAITool(toolType, bundleId);
        }

        function openAITool(toolType, bundleId = null) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content large-modal">
                    <div class="modal-header">
                        <h2 id="aiToolTitle">AI Tool</h2>
                        <button onclick="closeAIModal()" class="close-btn">×</button>
                    </div>
                    <div class="modal-body" id="aiToolContent">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Load tool content
            loadAIToolContent(toolType);
        }

        function loadAIToolContent(toolType) {
            const titleEl = document.getElementById('aiToolTitle');
            const contentEl = document.getElementById('aiToolContent');
            
            switch(toolType) {
                case 'lesson-plans':
                    titleEl.textContent = 'AI Lesson Plan Generator';
                    contentEl.innerHTML = `
                        <div class="lesson-plan-generator">
                            <div class="generator-header">
                                <h4><i class="fas fa-magic"></i> Create Custom Lesson Plans</h4>
                                <p>Generate comprehensive, NGSS-aligned lesson plans tailored to your curriculum needs.</p>
                            </div>
                            
                            <div class="ai-tool-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="lessonTopic">Lesson Topic *</label>
                                        <input type="text" id="lessonTopic" placeholder="e.g., Plant Adaptations, Food Chains, Rock Cycle">
                                    </div>
                                    <div class="form-group">
                                        <label for="bundle">STEM Bundle</label>
                                        <select id="bundle">
                                            <option value="bundle1">Bundle 1: Organism Structures</option>
                                            <option value="bundle2">Bundle 2: Earth's Surface</option>
                                            <option value="bundle3">Bundle 3: Energy & Forces</option>
                                            <option value="bundle4">Bundle 4: Engineering & Design</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="gradeLevel">Grade Level</label>
                                        <select id="gradeLevel">
                                            <option value="4">4th Grade</option>
                                            <option value="3">3rd Grade</option>
                                            <option value="5">5th Grade</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="duration">Duration</label>
                                        <select id="duration">
                                            <option value="45">45 minutes</option>
                                            <option value="60">60 minutes</option>
                                            <option value="90">90 minutes</option>
                                            <option value="120">2 hours</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="lessonType">Lesson Type</label>
                                    <select id="lessonType">
                                        <option value="regular">Regular Lesson</option>
                                        <option value="lab">Lab Investigation</option>
                                        <option value="review">Review & Assessment</option>
                                        <option value="extension">Extension Activity</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="objectives">Learning Objectives</label>
                                    <textarea id="objectives" placeholder="What should students learn? (Optional - AI will generate if left blank)"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="materials">Required Materials</label>
                                    <textarea id="materials" placeholder="List any specific materials needed (Optional)"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="difficulty">Difficulty Level</label>
                                    <select id="difficulty">
                                        <option value="beginner">Beginner</option>
                                        <option value="intermediate">Intermediate</option>
                                        <option value="advanced">Advanced</option>
                                    </select>
                                </div>
                                
                                <div class="generator-actions">
                                    <button class="btn btn-primary" onclick="generateLessonPlan()">
                                        <i class="fas fa-magic"></i> Generate Lesson Plan
                                    </button>
                                    <button class="btn btn-secondary" onclick="loadTemplate()">
                                        <i class="fas fa-file-alt"></i> Load Template
                                    </button>
                                </div>
                            </div>
                            
                            <div id="lessonPlanResult" style="display: none; margin-top: 30px;">
                                <div class="result-header">
                                    <h4><i class="fas fa-check-circle"></i> Generated Lesson Plan</h4>
                                    <div class="result-actions">
                                        <button class="btn btn-small" onclick="exportLessonPlan()">
                                            <i class="fas fa-download"></i> Export PDF
                                        </button>
                                        <button class="btn btn-small" onclick="saveLessonPlan()">
                                            <i class="fas fa-save"></i> Save
                                        </button>
                                    </div>
                                </div>
                                <div class="lesson-plan-content"></div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'rubrics':
                    titleEl.textContent = 'Rubric Creator';
                    contentEl.innerHTML = `
                        <div class="ai-tool-form">
                            <div class="form-group">
                                <label for="rubricTitle">Assessment Title</label>
                                <input type="text" id="rubricTitle" placeholder="e.g., Science Project Rubric">
                            </div>
                            <div class="form-group">
                                <label for="rubricType">Assessment Type</label>
                                <select id="rubricType">
                                    <option value="project">Project</option>
                                    <option value="presentation">Presentation</option>
                                    <option value="lab">Lab Report</option>
                                    <option value="quiz">Quiz</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="criteria">Assessment Criteria</label>
                                <textarea id="criteria" placeholder="List the criteria to be assessed..."></textarea>
                            </div>
                            <button class="btn btn-primary" onclick="generateRubric()">Generate Rubric</button>
                        </div>
                        <div id="rubricResult" style="display: none; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;"></div>
                    `;
                    break;
                    
                case 'newsletters':
                    titleEl.textContent = 'Newsletter Generator';
                    contentEl.innerHTML = `
                        <div class="ai-tool-form">
                            <div class="form-group">
                                <label for="newsletterTitle">Newsletter Title</label>
                                <input type="text" id="newsletterTitle" placeholder="e.g., STEM Update - January 2024">
                            </div>
                            <div class="form-group">
                                <label for="newsletterContent">Content to Include</label>
                                <textarea id="newsletterContent" placeholder="What topics should be covered?"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="newsletterTone">Tone</label>
                                <select id="newsletterTone">
                                    <option value="professional">Professional</option>
                                    <option value="friendly">Friendly</option>
                                    <option value="informative">Informative</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="generateNewsletter()">Generate Newsletter</button>
                        </div>
                        <div id="newsletterResult" style="display: none; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;"></div>
                    `;
                    break;
                    
                case 'assessments':
                    const selectedBundle = localStorage.getItem('selectedBundle') || 'bundle1';
                    const bundleInfo = {
                        'bundle1': 'Organism Structures',
                        'bundle2': 'Earth\'s Surface',
                        'bundle3': 'Energy & Forces',
                        'bundle4': 'Engineering & Design'
                    };
                    titleEl.textContent = `Assessment Builder - ${bundleInfo[selectedBundle]}`;
                    contentEl.innerHTML = `
                        <div class="assessment-builder">
                            <div class="generator-header">
                                <h4><i class="fas fa-question-circle"></i> Create Custom Assessments</h4>
                                <p>Generate comprehensive, NGSS-aligned assessments for ${bundleInfo[selectedBundle]}.</p>
                            </div>
                            
                            <div class="ai-tool-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="assessmentTopic">Assessment Topic *</label>
                                        <input type="text" id="assessmentTopic" placeholder="e.g., Plant Structures, Rock Cycle, Energy Transfer">
                                    </div>
                                    <div class="form-group">
                                        <label for="assessmentType">Assessment Type</label>
                                        <select id="assessmentType">
                                            <option value="quiz">Quick Quiz (5-10 questions)</option>
                                            <option value="test">Unit Test (15-25 questions)</option>
                                            <option value="project">Project Assessment</option>
                                            <option value="lab">Lab Report Assessment</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="questionCount">Number of Questions</label>
                                        <select id="questionCount">
                                            <option value="5">5 Questions</option>
                                            <option value="10">10 Questions</option>
                                            <option value="15">15 Questions</option>
                                            <option value="20">20 Questions</option>
                                            <option value="25">25 Questions</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="difficulty">Difficulty Level</label>
                                        <select id="difficulty">
                                            <option value="beginner">Beginner</option>
                                            <option value="intermediate">Intermediate</option>
                                            <option value="advanced">Advanced</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="questionTypes">Question Types</label>
                                    <select id="questionTypes">
                                        <option value="multiple-choice">Multiple Choice Only</option>
                                        <option value="mixed">Mixed Types (MC + Short Answer)</option>
                                        <option value="short-answer">Short Answer Only</option>
                                        <option value="comprehensive">Comprehensive (All Types)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="focusAreas">Focus Areas (Optional)</label>
                                    <textarea id="focusAreas" placeholder="List specific concepts or skills to focus on..."></textarea>
                                </div>
                                
                                <div class="generator-actions">
                                    <button class="btn btn-primary" onclick="generateAssessment()">
                                        <i class="fas fa-magic"></i> Generate Assessment
                                    </button>
                                    <button class="btn btn-secondary" onclick="loadAssessmentTemplate()">
                                        <i class="fas fa-file-alt"></i> Load Template
                                    </button>
                                </div>
                            </div>
                            
                            <div id="assessmentResult" style="display: none; margin-top: 30px;">
                                <div class="result-header">
                                    <h4><i class="fas fa-check-circle"></i> Generated Assessment</h4>
                                    <div class="result-actions">
                                        <button class="btn btn-small" onclick="exportAssessment()">
                                            <i class="fas fa-download"></i> Export PDF
                                        </button>
                                        <button class="btn btn-small" onclick="saveAssessment()">
                                            <i class="fas fa-save"></i> Save
                                        </button>
                                    </div>
                                </div>
                                <div class="assessment-content"></div>
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        function generateLessonPlan() {
            const topic = document.getElementById('lessonTopic').value;
            const bundle = document.getElementById('bundle').value;
            const gradeLevel = document.getElementById('gradeLevel').value;
            const duration = document.getElementById('duration').value;
            const lessonType = document.getElementById('lessonType').value;
            const objectives = document.getElementById('objectives').value;
            const materials = document.getElementById('materials').value;
            const difficulty = document.getElementById('difficulty').value;
            
            if (!topic) {
                alert('Please enter a lesson topic');
                return;
            }
            
            // Generate comprehensive lesson plan based on inputs
            const bundleInfo = {
                'bundle1': 'Organism Structures',
                'bundle2': 'Earth\'s Surface',
                'bundle3': 'Energy & Forces',
                'bundle4': 'Engineering & Design'
            };
            
            const durationNum = parseInt(duration);
            const warmupTime = Math.max(5, Math.floor(durationNum * 0.1));
            const introTime = Math.max(10, Math.floor(durationNum * 0.2));
            const activityTime = Math.max(15, Math.floor(durationNum * 0.5));
            const wrapupTime = Math.max(5, Math.floor(durationNum * 0.2));
            
            // Generate objectives if not provided
            const generatedObjectives = objectives || generateObjectives(topic, bundle, lessonType);
            
            // Generate materials if not provided
            const generatedMaterials = materials || generateMaterials(topic, lessonType);
            
            const result = `
                <div class="lesson-plan-content">
                    <h3>📚 Generated Lesson Plan: ${topic}</h3>
                    
                    <div class="highlight-box">
                        <strong>Bundle:</strong> ${bundleInfo[bundle]} | 
                        <strong>Grade:</strong> ${gradeLevel}th Grade | 
                        <strong>Duration:</strong> ${duration} minutes | 
                        <strong>Type:</strong> ${lessonType.charAt(0).toUpperCase() + lessonType.slice(1)} | 
                        <strong>Difficulty:</strong> ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}
                    </div>
                    
                    <h4>🎯 Learning Objectives</h4>
                    <ul>
                        ${generatedObjectives}
                    </ul>
                    
                    <h4>⏰ Lesson Structure (${duration} minutes)</h4>
                    <ol>
                        <li><strong>Warm-up Activity</strong> (${warmupTime} minutes)
                            <ul>
                                <li>Engage students with a quick question or observation</li>
                                <li>Connect to prior knowledge about ${topic}</li>
                            </ul>
                        </li>
                        <li><strong>Introduction & Vocabulary</strong> (${introTime} minutes)
                            <ul>
                                <li>Introduce key concepts and vocabulary</li>
                                <li>Show examples and demonstrations</li>
                                <li>Set up the main activity</li>
                            </ul>
                        </li>
                        <li><strong>Main Activity</strong> (${activityTime} minutes)
                            <ul>
                                <li>${generateActivityDescription(topic, lessonType, difficulty)}</li>
                                <li>Students work individually or in small groups</li>
                                <li>Teacher circulates and provides support</li>
                            </ul>
                        </li>
                        <li><strong>Wrap-up & Reflection</strong> (${wrapupTime} minutes)
                            <ul>
                                <li>Share findings and observations</li>
                                <li>Connect back to learning objectives</li>
                                <li>Preview next lesson</li>
                            </ul>
                        </li>
                    </ol>
                    
                    <div class="materials-list">
                        <h4>📦 Materials Needed</h4>
                        <ul>
                            ${generatedMaterials}
                        </ul>
                    </div>
                    
                    <h4>📊 Assessment & Evaluation</h4>
                    <ul>
                        <li>Observation during hands-on activities</li>
                        <li>Student participation in discussions</li>
                        <li>Completion of activity worksheets</li>
                        <li>Exit ticket or reflection questions</li>
                    </ul>
                    
                    <h4>🔗 NGSS Standards Alignment</h4>
                    <p>This lesson aligns with ${bundleInfo[bundle]} standards and supports the following NGSS practices:</p>
                    <ul>
                        <li>Asking Questions and Defining Problems</li>
                        <li>Planning and Carrying Out Investigations</li>
                        <li>Analyzing and Interpreting Data</li>
                        <li>Constructing Explanations and Designing Solutions</li>
                    </ul>
                    
                    <h4>💡 Differentiation Strategies</h4>
                    <ul>
                        <li><strong>For Advanced Students:</strong> Provide extension questions and additional challenges</li>
                        <li><strong>For Struggling Students:</strong> Offer additional support and simplified instructions</li>
                        <li><strong>For ELL Students:</strong> Use visual aids and provide vocabulary support</li>
                    </ul>
                    
                    <h4>🏠 Extension Activities</h4>
                    <ul>
                        <li>Research project on related topics</li>
                        <li>Create a presentation or poster</li>
                        <li>Conduct additional experiments at home</li>
                        <li>Write a reflection journal entry</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('lessonPlanResult').style.display = 'block';
            document.querySelector('.lesson-plan-content').innerHTML = result;
        }

        function generateObjectives(topic, bundle, lessonType) {
            const objectives = {
                'bundle1': [
                    `<li>Students will identify and describe the structures of plants and animals</li>`,
                    `<li>Students will explain how different structures help organisms survive</li>`,
                    `<li>Students will compare and contrast plant and animal structures</li>`
                ],
                'bundle2': [
                    `<li>Students will describe how Earth's surface changes over time</li>`,
                    `<li>Students will identify different types of rocks and minerals</li>`,
                    `<li>Students will explain the processes of weathering and erosion</li>`
                ],
                'bundle3': [
                    `<li>Students will understand different forms of energy</li>`,
                    `<li>Students will explore how forces affect motion</li>`,
                    `<li>Students will investigate energy transfer and transformation</li>`
                ],
                'bundle4': [
                    `<li>Students will apply engineering design process</li>`,
                    `<li>Students will solve problems using scientific principles</li>`,
                    `<li>Students will create and test prototypes</li>`
                ]
            };
            
            return objectives[bundle] ? objectives[bundle].join('') : 
                `<li>Students will understand key concepts related to ${topic}</li>
                 <li>Students will apply scientific thinking and problem-solving</li>
                 <li>Students will communicate their findings effectively</li>`;
        }

        function generateMaterials(topic, lessonType) {
            const baseMaterials = [
                '<li>Science notebooks or worksheets</li>',
                '<li>Pencils and colored pencils</li>',
                '<li>Rulers or measuring tools</li>'
            ];
            
            const specificMaterials = {
                'lab': [
                    '<li>Safety goggles</li>',
                    '<li>Lab equipment (varies by investigation)</li>',
                    '<li>Data collection sheets</li>'
                ],
                'regular': [
                    '<li>Visual aids and diagrams</li>',
                    '<li>Interactive materials</li>',
                    '<li>Reference books or resources</li>'
                ],
                'review': [
                    '<li>Review worksheets</li>',
                    '<li>Assessment materials</li>',
                    '<li>Answer keys</li>'
                ],
                'extension': [
                    '<li>Additional research materials</li>',
                    '<li>Creative supplies</li>',
                    '<li>Technology devices (if applicable)</li>'
                ]
            };
            
            return [...baseMaterials, ...(specificMaterials[lessonType] || [])].join('');
        }

        function generateActivityDescription(topic, lessonType, difficulty) {
            const activities = {
                'lab': `Hands-on investigation where students ${difficulty === 'beginner' ? 'observe and record' : difficulty === 'intermediate' ? 'experiment and analyze' : 'design and conduct experiments'} related to ${topic}`,
                'regular': `Interactive learning activity where students ${difficulty === 'beginner' ? 'explore and discuss' : difficulty === 'intermediate' ? 'investigate and explain' : 'analyze and synthesize'} concepts about ${topic}`,
                'review': `Comprehensive review session where students ${difficulty === 'beginner' ? 'practice and reinforce' : difficulty === 'intermediate' ? 'apply and demonstrate' : 'evaluate and critique'} their understanding of ${topic}`,
                'extension': `Extended learning activity where students ${difficulty === 'beginner' ? 'explore further' : difficulty === 'intermediate' ? 'investigate deeper' : 'research and create'} connections beyond ${topic}`
            };
            
            return activities[lessonType] || `Engaging activity focused on ${topic}`;
        }

        function loadTemplate() {
            alert('Template loading feature coming soon! This will provide pre-made lesson plan templates for different topics.');
        }

        function exportLessonPlan() {
            const content = document.querySelector('.lesson-plan-content').innerHTML;
            const blob = new Blob([`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Lesson Plan - ${document.getElementById('lessonTopic').value}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h3, h4 { color: #333; }
                        ul, ol { margin: 10px 0; }
                        .highlight-box { background: #e3f2fd; padding: 15px; margin: 15px 0; border-left: 4px solid #2196f3; }
                        .materials-list { background: #fff3cd; padding: 15px; margin: 15px 0; border-left: 4px solid #ffc107; }
                    </style>
                </head>
                <body>
                    ${content}
                </body>
                </html>
            `], { type: 'text/html' });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lesson-plan-${document.getElementById('lessonTopic').value.replace(/\s+/g, '-').toLowerCase()}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function saveLessonPlan() {
            const lessonData = {
                topic: document.getElementById('lessonTopic').value,
                bundle: document.getElementById('bundle').value,
                gradeLevel: document.getElementById('gradeLevel').value,
                duration: document.getElementById('duration').value,
                lessonType: document.getElementById('lessonType').value,
                objectives: document.getElementById('objectives').value,
                materials: document.getElementById('materials').value,
                difficulty: document.getElementById('difficulty').value,
                generatedDate: new Date().toISOString()
            };
            
            // Save to localStorage (in a real app, this would save to a database)
            const savedLessons = JSON.parse(localStorage.getItem('savedLessonPlans') || '[]');
            savedLessons.push(lessonData);
            localStorage.setItem('savedLessonPlans', JSON.stringify(savedLessons));
            
            alert('Lesson plan saved successfully! You can access it later from your saved plans.');
        }

        function generateAssessment() {
            const topic = document.getElementById('assessmentTopic').value;
            const assessmentType = document.getElementById('assessmentType').value;
            const questionCount = parseInt(document.getElementById('questionCount').value);
            const questionTypes = document.getElementById('questionTypes').value;
            const difficulty = document.getElementById('difficulty').value;
            const focusAreas = document.getElementById('focusAreas').value;
            const selectedBundle = localStorage.getItem('selectedBundle') || 'bundle1';
            
            if (!topic) {
                alert('Please enter an assessment topic');
                return;
            }
            image.png
            const bundleInfo = {
                'bundle1': 'Organism Structures',
                'bundle2': 'Earth\'s Surface',
                'bundle3': 'Energy & Forces',
                'bundle4': 'Engineering & Design'
            };
            
            // Generate assessment questions based on bundle and topic
            const questions = generateAssessmentQuestions(topic, selectedBundle, questionCount, questionTypes, difficulty);
            
            const result = `
                <div class="assessment-content">
                    <h3>📝 Generated Assessment: ${topic}</h3>
                    
                    <div class="highlight-box">
                        <strong>Bundle:</strong> ${bundleInfo[selectedBundle]} | 
                        <strong>Type:</strong> ${assessmentType.charAt(0).toUpperCase() + assessmentType.slice(1)} | 
                        <strong>Questions:</strong> ${questionCount} | 
                        <strong>Difficulty:</strong> ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}
                    </div>
                    
                    <div class="assessment-instructions">
                        <h4>📋 Instructions for Students</h4>
                        <ul>
                            <li>Read each question carefully before answering</li>
                            <li>Use complete sentences for short answer questions</li>
                            <li>Show your work for any calculations</li>
                            <li>Use scientific vocabulary when appropriate</li>
                            <li>Time limit: ${questionCount * 2} minutes</li>
                        </ul>
                    </div>
                    
                    <div class="questions-section">
                        <h4>📝 Assessment Questions</h4>
                        ${questions}
                    </div>
                    
                    <div class="materials-list">
                        <h4>📊 Answer Key & Grading Rubric</h4>
                        <ul>
                            <li>Multiple Choice: 1 point each</li>
                            <li>Short Answer: 2-3 points each (based on completeness)</li>
                            <li>Essay Questions: 5-10 points each (based on depth and accuracy)</li>
                            <li>Total Points: ${calculateTotalPoints(questionCount, questionTypes)}</li>
                        </ul>
                    </div>
                    
                    <div class="assessment-notes">
                        <h4>📚 Teacher Notes</h4>
                        <ul>
                            <li>This assessment aligns with NGSS standards for ${bundleInfo[selectedBundle]}</li>
                            <li>Consider allowing students to use their science notebooks</li>
                            <li>Provide additional time for ELL students if needed</li>
                            <li>Review answers as a class for immediate feedback</li>
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('assessmentResult').style.display = 'block';
            document.querySelector('.assessment-content').innerHTML = result;
        }

        function generateAssessmentQuestions(topic, bundle, count, types, difficulty) {
            const bundleQuestions = {
                'bundle1': [
                    {
                        type: 'multiple-choice',
                        question: 'What is the main function of plant roots?',
                        options: ['A) To make food', 'B) To absorb water and nutrients', 'C) To produce flowers', 'D) To store energy'],
                        answer: 'B'
                    },
                    {
                        type: 'short-answer',
                        question: 'Explain how a bird\'s beak is adapted to its diet.',
                        answer: 'Student should explain how beak shape relates to food type (e.g., sharp beak for tearing meat, long beak for reaching nectar)'
                    },
                    {
                        type: 'multiple-choice',
                        question: 'Which of the following is a producer in a food chain?',
                        options: ['A) Rabbit', 'B) Grass', 'C) Hawk', 'D) Snake'],
                        answer: 'B'
                    }
                ],
                'bundle2': [
                    {
                        type: 'multiple-choice',
                        question: 'What process breaks down rocks into smaller pieces?',
                        options: ['A) Erosion', 'B) Weathering', 'C) Deposition', 'D) Sedimentation'],
                        answer: 'B'
                    },
                    {
                        type: 'short-answer',
                        question: 'Describe the rock cycle and how rocks can change from one type to another.',
                        answer: 'Student should explain igneous, sedimentary, and metamorphic rock formation and transformation processes'
                    },
                    {
                        type: 'multiple-choice',
                        question: 'Which layer of Earth is the thickest?',
                        options: ['A) Crust', 'B) Mantle', 'C) Outer Core', 'D) Inner Core'],
                        answer: 'B'
                    }
                ]
            };
            
            const questions = bundleQuestions[bundle] || bundleQuestions['bundle1'];
            let html = '';
            
            for (let i = 0; i < Math.min(count, questions.length); i++) {
                const q = questions[i];
                html += `
                    <div class="question-item">
                        <h5>Question ${i + 1}: ${q.type === 'multiple-choice' ? 'Multiple Choice' : 'Short Answer'}</h5>
                        <p><strong>${q.question}</strong></p>
                        ${q.options ? `<ul>${q.options.map(opt => `<li>${opt}</li>`).join('')}</ul>` : ''}
                        <div class="answer-space">
                            ${q.type === 'short-answer' ? '<textarea placeholder="Your answer here..." rows="3"></textarea>' : ''}
                        </div>
                    </div>
                `;
            }
            
            return html;
        }

        function calculateTotalPoints(count, types) {
            if (types === 'multiple-choice') return count;
            if (types === 'short-answer') return count * 2;
            if (types === 'mixed') return Math.floor(count * 1.5);
            return count * 2;
        }

        function loadAssessmentTemplate() {
            alert('Assessment template loading feature coming soon! This will provide pre-made assessment templates for different topics.');
        }

        function exportAssessment() {
            const content = document.querySelector('.assessment-content').innerHTML;
            const blob = new Blob([`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Assessment - ${document.getElementById('assessmentTopic').value}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h3, h4 { color: #333; }
                        ul, ol { margin: 10px 0; }
                        .highlight-box { background: #e3f2fd; padding: 15px; margin: 15px 0; border-left: 4px solid #2196f3; }
                        .materials-list { background: #fff3cd; padding: 15px; margin: 15px 0; border-left: 4px solid #ffc107; }
                        .question-item { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
                    </style>
                </head>
                <body>
                    ${content}
                </body>
                </html>
            `], { type: 'text/html' });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `assessment-${document.getElementById('assessmentTopic').value.replace(/\s+/g, '-').toLowerCase()}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function saveAssessment() {
            const assessmentData = {
                topic: document.getElementById('assessmentTopic').value,
                bundle: localStorage.getItem('selectedBundle'),
                assessmentType: document.getElementById('assessmentType').value,
                questionCount: document.getElementById('questionCount').value,
                questionTypes: document.getElementById('questionTypes').value,
                difficulty: document.getElementById('difficulty').value,
                focusAreas: document.getElementById('focusAreas').value,
                generatedDate: new Date().toISOString()
            };
            
            // Save to localStorage (in a real app, this would save to a database)
            const savedAssessments = JSON.parse(localStorage.getItem('savedAssessments') || '[]');
            savedAssessments.push(assessmentData);
            localStorage.setItem('savedAssessments', JSON.stringify(savedAssessments));
            
            alert('Assessment saved successfully! You can access it later from your saved assessments.');
        }

        function generateRubric() {
            const title = document.getElementById('rubricTitle').value;
            const type = document.getElementById('rubricType').value;
            const criteria = document.getElementById('criteria').value;
            
            if (!title) {
                alert('Please enter an assessment title');
                return;
            }
            
            const result = `
                <h3>Generated Rubric: ${title}</h3>
                <div class="rubric">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="border: 1px solid #ddd; padding: 10px;">Criteria</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">Excellent (4)</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">Good (3)</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">Satisfactory (2)</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">Needs Improvement (1)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">Understanding of Concepts</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Demonstrates complete understanding</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Shows good understanding</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Basic understanding evident</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Limited understanding</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">Application of Knowledge</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Applies knowledge effectively</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Good application of concepts</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Some application shown</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Minimal application</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">Communication</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Clear and effective communication</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Good communication skills</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Adequate communication</td>
                                <td style="border: 1px solid #ddd; padding: 10px;">Communication needs improvement</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('rubricResult').innerHTML = result;
            document.getElementById('rubricResult').style.display = 'block';
        }

        function generateNewsletter() {
            const title = document.getElementById('newsletterTitle').value;
            const content = document.getElementById('newsletterContent').value;
            const tone = document.getElementById('newsletterTone').value;
            
            if (!title) {
                alert('Please enter a newsletter title');
                return;
            }
            
            const result = `
                <h3>Generated Newsletter: ${title}</h3>
                <div class="newsletter">
                    <h4>Dear Parents and Guardians,</h4>
                    <p>We hope this newsletter finds you well! We're excited to share updates about our STEM curriculum and the amazing learning happening in our 4th grade classrooms.</p>
                    
                    <h4>What We've Been Learning:</h4>
                    <p>Our students have been actively engaged in hands-on science investigations, exploring concepts through interactive lessons and collaborative projects. The enthusiasm and curiosity they bring to each lesson is truly inspiring.</p>
                    
                    <h4>Upcoming Events:</h4>
                    <ul>
                        <li>Science Fair - March 15th</li>
                        <li>Parent-Teacher Conferences - March 20-22</li>
                        <li>STEM Showcase - April 10th</li>
                    </ul>
                    
                    <h4>How You Can Support Learning at Home:</h4>
                    <ul>
                        <li>Ask your child about their daily science discoveries</li>
                        <li>Encourage questions and exploration</li>
                        <li>Visit local science museums or nature centers</li>
                        <li>Practice math and measurement during cooking or building projects</li>
                    </ul>
                    
                    <p>Thank you for your continued support of your child's education. Together, we're building a strong foundation for lifelong learning!</p>
                    
                    <p>Best regards,<br>
                    The 4th Grade STEM Team</p>
                </div>
            `;
            
            document.getElementById('newsletterResult').innerHTML = result;
            document.getElementById('newsletterResult').style.display = 'block';
        }

        function generateAssessment() {
            const topic = document.getElementById('assessmentTopic').value;
            const count = document.getElementById('questionCount').value;
            const type = document.getElementById('questionTypes').value;
            
            if (!topic) {
                alert('Please enter an assessment topic');
                return;
            }
            
            const result = `
                <h3>Generated Assessment: ${topic}</h3>
                <div class="assessment">
                    <h4>Instructions: Answer all questions to the best of your ability.</h4>
                    
                    <div class="questions">
                        <div class="question">
                            <h5>1. What is the main concept we studied in ${topic}?</h5>
                            <div class="options">
                                <label><input type="radio" name="q1"> Option A</label><br>
                                <label><input type="radio" name="q1"> Option B</label><br>
                                <label><input type="radio" name="q1"> Option C</label><br>
                                <label><input type="radio" name="q1"> Option D</label>
                            </div>
                        </div>
                        
                        <div class="question">
                            <h5>2. Explain how ${topic} relates to everyday life.</h5>
                            <textarea style="width: 100%; height: 80px; margin-top: 10px;" placeholder="Your answer here..."></textarea>
                        </div>
                        
                        <div class="question">
                            <h5>3. Which of the following is an example of ${topic}?</h5>
                            <div class="options">
                                <label><input type="radio" name="q3"> Example A</label><br>
                                <label><input type="radio" name="q3"> Example B</label><br>
                                <label><input type="radio" name="q3"> Example C</label><br>
                                <label><input type="radio" name="q3"> Example D</label>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" style="margin-top: 20px;">Submit Assessment</button>
                </div>
            `;
            
            document.getElementById('assessmentResult').innerHTML = result;
            document.getElementById('assessmentResult').style.display = 'block';
        }

        function closeAIModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        // Collapsible Sections functionality
        function toggleSection(sectionName) {
            const content = document.getElementById(sectionName + '-content');
            const chevron = document.getElementById(sectionName + '-chevron');
            
            if (content.classList.contains('expanded')) {
                // Collapse section
                content.classList.remove('expanded');
                chevron.style.transform = 'translateY(-50%) rotate(0deg)';
                localStorage.setItem(sectionName + '_expanded', 'false');
            } else {
                // Expand section
                content.classList.add('expanded');
                chevron.style.transform = 'translateY(-50%) rotate(180deg)';
                localStorage.setItem(sectionName + '_expanded', 'true');
            }
        }

        function loadSectionStates() {
            // Load saved section states
            const sections = ['gemini', 'management'];
            sections.forEach(section => {
                const isExpanded = localStorage.getItem(section + '_expanded') === 'true';
                const content = document.getElementById(section + '-content');
                const chevron = document.getElementById(section + '-chevron');
                
                if (isExpanded) {
                    content.classList.add('expanded');
                    chevron.style.transform = 'translateY(-50%) rotate(180deg)';
                }
            });
            
            // Load chat history if Gemini section is expanded
            if (localStorage.getItem('gemini_expanded') === 'true') {
                setTimeout(loadChatHistory, 200);
            }
            
            // Load tab state after a short delay to ensure DOM is ready
            setTimeout(loadTabState, 100);
        }

        // Integrated Tools functionality
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Save tab state
            localStorage.setItem('active_management_tab', tabName);
        }

        function loadTabState() {
            const activeTab = localStorage.getItem('active_management_tab') || 'classdojo';
            const tabButton = document.querySelector(`[onclick="switchTab('${activeTab}')"]`);
            if (tabButton) {
                tabButton.click();
            }
        }

        function selectStudent(studentId) {
            // Highlight selected student
            document.querySelectorAll('.student-card').forEach(card => {
                card.style.border = '2px solid rgba(255,255,255,0.2)';
            });
            event.target.closest('.student-card').style.border = '2px solid #28a745';
            
            // Show student details modal (placeholder)
            showStudentDetails(studentId);
        }

        function showStudentDetails(studentId) {
            const studentData = {
                'student1': { name: 'Alex Johnson', points: 15, behaviors: ['Great participation', 'Helped with cleanup'] },
                'student2': { name: 'Emma Davis', points: 22, behaviors: ['Helped classmates', 'Excellent work'] },
                'student3': { name: 'Marcus Wilson', points: 8, behaviors: ['Needs focus', 'Working on behavior'] },
                'student4': { name: 'Sophia Chen', points: 18, behaviors: ['Excellent work', 'Great leadership'] }
            };
            
            const student = studentData[studentId];
            if (student) {
                alert(`Student: ${student.name}\nPoints: ${student.points}\nRecent Behaviors: ${student.behaviors.join(', ')}`);
            }
        }

        // ClassDojo Integration Functions
        function signInToClassDojo() {
            // Simulate Google Sign-In for ClassDojo
            const isSignedIn = localStorage.getItem('classdojo_signed_in') === 'true';
            
            if (!isSignedIn) {
                // Show Google Sign-In modal
                showGoogleSignInModal();
            } else {
                // Already signed in, show dashboard
                showClassDojoDashboard();
            }
        }

        function showGoogleSignInModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fab fa-google"></i> Sign in to ClassDojo</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Connect your Google account to access ClassDojo features:</p>
                        <div class="google-signin-options">
                            <button class="google-signin-btn" onclick="authenticateWithGoogle()">
                                <i class="fab fa-google"></i>
                                <span>Sign in with Google</span>
                            </button>
                        </div>
                        <p class="signin-benefits">
                            <strong>Benefits:</strong><br>
                            • Sync student data with ClassDojo<br>
                            • Access parent communication tools<br>
                            • Manage classroom behavior tracking<br>
                            • Generate progress reports
                        </p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function authenticateWithGoogle() {
            // Simulate successful authentication
            localStorage.setItem('classdojo_signed_in', 'true');
            localStorage.setItem('classdojo_teacher_name', 'Ms. Johnson');
            localStorage.setItem('classdojo_class_name', 'STEM Class - 4th Grade');
            
            closeModal();
            showClassDojoDashboard();
            loadStudents();
        }

        function showClassDojoDashboard() {
            document.getElementById('classdojo-signin').style.display = 'none';
            document.getElementById('classdojo-dashboard-content').style.display = 'block';
        }

        function loadStudents() {
            const studentsGrid = document.getElementById('students-grid');
            const students = [
                { id: 'student1', name: 'Alex Johnson', avatar: '🦊', points: 15, behaviors: ['Great participation'] },
                { id: 'student2', name: 'Emma Davis', avatar: '🐰', points: 22, behaviors: ['Helped classmates'] },
                { id: 'student3', name: 'Marcus Wilson', avatar: '🐻', points: 8, behaviors: ['Needs focus'] },
                { id: 'student4', name: 'Sophia Chen', avatar: '🦋', points: 18, behaviors: ['Excellent work'] },
                { id: 'student5', name: 'Liam Rodriguez', avatar: '🐸', points: 12, behaviors: ['Creative thinking'] },
                { id: 'student6', name: 'Zoe Patel', avatar: '🐨', points: 20, behaviors: ['Great leadership'] }
            ];

            studentsGrid.innerHTML = students.map(student => `
                <div class="student-card" onclick="selectStudent('${student.id}')">
                    <div class="student-avatar">${student.avatar}</div>
                    <h4>${student.name}</h4>
                    <div class="student-points">
                        <span class="points-positive">+${student.points}</span>
                    </div>
                    <div class="recent-behaviors">
                        <span class="behavior-positive">${student.behaviors[0]}</span>
                    </div>
                </div>
            `).join('');
        }

        function openClassDojoModal(type) {
            if (type === 'setup') {
                showClassSetupModal();
            } else if (type === 'skills') {
                showSkillsModal();
            } else if (type === 'points') {
                showPointsModal();
            } else if (type === 'behavior') {
                showBehaviorModal();
            }
        }

        function showClassSetupModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content large-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-cog"></i> Class Setup</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setup-section">
                            <h4>Class Information</h4>
                            <div class="form-group">
                                <label>Class Name:</label>
                                <input type="text" id="class-name" value="STEM Class - 4th Grade" placeholder="Enter class name">
                            </div>
                            <div class="form-group">
                                <label>Grade Level:</label>
                                <select id="grade-level">
                                    <option value="4th">4th Grade</option>
                                    <option value="3rd">3rd Grade</option>
                                    <option value="5th">5th Grade</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setup-section">
                            <h4>Add Students</h4>
                            <div class="add-student-form">
                                <input type="text" id="student-name" placeholder="Student name">
                                <button onclick="addStudent()" class="btn-primary">Add Student</button>
                            </div>
                            <div class="students-list" id="students-list">
                                <!-- Students will be added here -->
                            </div>
                        </div>
                        
                        <div class="setup-section">
                            <h4>Class Skills</h4>
                            <div class="skills-grid">
                                <div class="skill-item">
                                    <input type="checkbox" id="skill-participation" checked>
                                    <label for="skill-participation">Participation</label>
                                </div>
                                <div class="skill-item">
                                    <input type="checkbox" id="skill-helping" checked>
                                    <label for="skill-helping">Helping Others</label>
                                </div>
                                <div class="skill-item">
                                    <input type="checkbox" id="skill-focus" checked>
                                    <label for="skill-focus">Focus & Attention</label>
                                </div>
                                <div class="skill-item">
                                    <input type="checkbox" id="skill-creativity">
                                    <label for="skill-creativity">Creativity</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button onclick="saveClassSetup()" class="btn-primary">Save Setup</button>
                            <button onclick="closeModal()" class="btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showSkillsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-star"></i> Manage Skills</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="skills-management">
                            <h4>Current Skills</h4>
                            <div class="skills-list">
                                <div class="skill-item">
                                    <span class="skill-name">Participation</span>
                                    <span class="skill-points">+2 points</span>
                                    <button class="btn-small" onclick="editSkill('participation')">Edit</button>
                                </div>
                                <div class="skill-item">
                                    <span class="skill-name">Helping Others</span>
                                    <span class="skill-points">+3 points</span>
                                    <button class="btn-small" onclick="editSkill('helping')">Edit</button>
                                </div>
                                <div class="skill-item">
                                    <span class="skill-name">Focus & Attention</span>
                                    <span class="skill-points">+1 point</span>
                                    <button class="btn-small" onclick="editSkill('focus')">Edit</button>
                                </div>
                            </div>
                            
                            <div class="add-skill-form">
                                <h4>Add New Skill</h4>
                                <input type="text" id="new-skill-name" placeholder="Skill name">
                                <input type="number" id="new-skill-points" placeholder="Points" min="1" max="10">
                                <button onclick="addSkill()" class="btn-primary">Add Skill</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showPointsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-plus"></i> Award Points</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="points-form">
                            <div class="form-group">
                                <label>Select Students:</label>
                                <div class="students-checkboxes" id="students-checkboxes">
                                    <!-- Students will be loaded here -->
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Skill:</label>
                                <select id="skill-select">
                                    <option value="participation">Participation (+2)</option>
                                    <option value="helping">Helping Others (+3)</option>
                                    <option value="focus">Focus & Attention (+1)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Note (optional):</label>
                                <textarea id="points-note" placeholder="Add a note about why points were awarded..."></textarea>
                            </div>
                            <div class="modal-actions">
                                <button onclick="awardPoints()" class="btn-primary">Award Points</button>
                                <button onclick="closeModal()" class="btn-secondary">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            loadStudentsForPoints();
        }

        function showBehaviorModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-edit"></i> Log Behavior</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="behavior-form">
                            <div class="form-group">
                                <label>Select Student:</label>
                                <select id="behavior-student">
                                    <option value="">Choose a student...</option>
                                    <option value="student1">Alex Johnson</option>
                                    <option value="student2">Emma Davis</option>
                                    <option value="student3">Marcus Wilson</option>
                                    <option value="student4">Sophia Chen</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Behavior Type:</label>
                                <select id="behavior-type">
                                    <option value="positive">Positive Behavior</option>
                                    <option value="negative">Needs Improvement</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Description:</label>
                                <textarea id="behavior-description" placeholder="Describe the behavior..."></textarea>
                            </div>
                            <div class="modal-actions">
                                <button onclick="logBehavior()" class="btn-primary">Log Behavior</button>
                                <button onclick="closeModal()" class="btn-secondary">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function openVeracrossModal(type) {
            if (type === 'grades') {
                alert('Opening Veracross Gradebook...\n\nThis would integrate with your Veracross system to show:\n- Current grades\n- Assignment details\n- Grade trends\n- Student progress');
            } else if (type === 'attendance') {
                alert('Opening Veracross Attendance...\n\nThis would integrate with your Veracross system to show:\n- Daily attendance\n- Absence patterns\n- Tardy tracking\n- Parent notifications');
            }
        }

        function openGradingModal(type) {
            if (type === 'assignment') {
                const assignmentName = prompt('Enter assignment name:');
                const totalPoints = prompt('Enter total points:');
                if (assignmentName && totalPoints) {
                    alert(`Created new assignment: "${assignmentName}" (${totalPoints} points)`);
                    // Add to assignment dropdown
                    const select = document.getElementById('assignment-select');
                    const option = document.createElement('option');
                    option.value = assignmentName.toLowerCase().replace(/\s+/g, '-');
                    option.textContent = assignmentName;
                    select.appendChild(option);
                }
            } else if (type === 'rubric') {
                alert('Opening Rubric Creator...\n\nThis would allow you to create:\n- Custom rubrics\n- Grading criteria\n- Point scales\n- Feedback templates');
            }
        }

        function loadAssignmentGrades() {
            const assignment = document.getElementById('assignment-select').value;
            if (assignment) {
                alert(`Loading grades for: ${assignment}\n\nThis would load actual student grades from your system.`);
                // Here you would load real grade data
            }
        }

        function saveGrade(studentId) {
            const gradeInput = event.target.previousElementSibling;
            const feedbackInput = gradeInput.parentElement.nextElementSibling.querySelector('input');
            const grade = gradeInput.value;
            const feedback = feedbackInput.value;
            
            if (grade) {
                alert(`Grade saved for ${studentId}: ${grade}\nFeedback: ${feedback || 'No feedback provided'}`);
                // Here you would save to your gradebook system
            } else {
                alert('Please enter a grade before saving.');
            }
        }

        // Gemini AI functionality
        let currentCategory = null;
        let categoryPrompts = {
            vocabulary: [
                "What is the definition of adaptation?",
                "Explain the difference between structure and function",
                "What does ecosystem mean?",
                "Define photosynthesis",
                "What is a food chain?",
                "Explain what a producer is",
                "What does consumer mean?",
                "What is biodiversity?",
                "Define habitat and environment",
                "What is a species?",
                "Explain natural selection",
                "What does evolution mean?",
                "Define camouflage and mimicry",
                "What is migration?",
                "Explain hibernation",
                "What does metamorphosis mean?",
                "Define life cycle",
                "What is reproduction?",
                "Explain germination",
                "What does pollination mean?",
                "Define decomposer",
                "What is weathering?",
                "Define erosion",
                "What is the rock cycle?",
                "Explain what energy is",
                "What is a force?",
                "What is gravity?",
                "Define simple machine"
            ],
            animals: [
                "How do animals adapt to their environment?",
                "What are some examples of animal camouflage?",
                "What structures do bees have?",
                "How do birds fly?",
                "What adaptations help fish swim?",
                "How do mammals stay warm?",
                "What are the different types of animal teeth?",
                "How do animals communicate?",
                "What is animal behavior?",
                "How do animals find food?",
                "What are predator and prey relationships?",
                "How do animals protect themselves?",
                "What is animal migration?",
                "How do animals reproduce?",
                "What are the life cycles of different animals?",
                "How do animals change with seasons?",
                "What are animal habitats?",
                "How do animals work together?",
                "What are endangered species?",
                "How do animals help the environment?",
                "Explain animal migration patterns",
                "How do animals survive in winter?",
                "What are inherited vs learned behaviors?",
                "PROBLEM: A farmer's crops are being eaten by rabbits. How can we help?",
                "PROBLEM: Birds are losing their homes due to deforestation. What can we do?",
                "PROBLEM: A zoo needs to design a habitat for polar bears. What should they include?",
                "PROBLEM: How can we help endangered sea turtles survive?",
                "REAL WORLD: How do engineers study animal adaptations to solve human problems?",
                "REAL WORLD: How do scientists track animal migration to protect species?",
                "Explain animal life cycles"
            ],
            plants: [
                "How do plants make their own food?",
                "What are the main parts of a plant?",
                "Explain the plant life cycle",
                "How do plants reproduce?",
                "What is pollination?",
                "How do seeds grow into plants?",
                "What do plants need to survive?",
                "Explain how plants adapt to their environment",
                "PROBLEM: A garden is not growing well. What could be wrong?",
                "PROBLEM: How can we help plants survive during a drought?",
                "PROBLEM: A forest is being destroyed by insects. How can we help?",
                "PROBLEM: How can we grow food in space?",
                "REAL WORLD: How do farmers use science to grow better crops?",
                "REAL WORLD: How do scientists use plants to clean polluted water?"
            ],
            earth: [
                "How do rocks form?",
                "What is the water cycle?",
                "Explain weather patterns",
                "What causes seasons?",
                "How do natural disasters happen?",
                "What are Earth's natural resources?",
                "Explain the rock cycle",
                "How does weathering and erosion work?",
                "PROBLEM: A town is flooding during heavy rain. How can we help?",
                "PROBLEM: A beach is losing sand due to erosion. What can we do?",
                "PROBLEM: How can we protect buildings from earthquakes?",
                "PROBLEM: A mountain is being destroyed by mining. How can we help?",
                "REAL WORLD: How do engineers build earthquake-resistant buildings?",
                "REAL WORLD: How do scientists predict and prepare for natural disasters?"
            ],
            energy: [
                "What are the different forms of energy?",
                "How does energy transfer in collisions?",
                "Explain the bowling ball collision investigation",
                "What happens when marbles collide?",
                "How do simple machines work?",
                "What is a lever and how does it help?",
                "How do pulleys make lifting easier?",
                "Explain electricity and circuits",
                "What is a conductor vs insulator?",
                "How do electric circuits work?",
                "What is magnetism?",
                "How do magnets attract and repel?",
                "How does light travel?",
                "What causes sound?",
                "Explain energy transfer",
                "How do forces affect motion?",
                "What is friction and how does it work?",
                "How does gravity affect objects?",
                "What are the six simple machines?",
                "How do wheels and axles work?",
                "What is an inclined plane?",
                "PROBLEM: A bowling ball needs to knock down all pins. How can we improve the collision?",
                "PROBLEM: A heavy box needs to be moved up stairs. What's the best way?",
                "PROBLEM: A town's electricity goes out during a storm. How can we help?",
                "PROBLEM: A playground needs safer equipment. How can we design it?",
                "PROBLEM: How can we make a car use less fuel?",
                "PROBLEM: Design a pulley system to lift heavy objects",
                "PROBLEM: Create a circuit that lights up multiple bulbs",
                "PROBLEM: Build a ramp that makes moving objects easier",
                "PROBLEM: Design a friction challenge for toy cars",
                "PROBLEM: Create a domino chain reaction",
                "REAL WORLD: How do engineers design wind turbines to generate clean energy?",
                "REAL WORLD: How do scientists use simple machines to solve everyday problems?",
                "REAL WORLD: How do collision engineers make cars safer?",
                "REAL WORLD: How do electricians design safe circuits?",
                "REAL WORLD: How do engineers use magnetism in technology?",
                "REAL WORLD: How do scientists study energy transfer in sports?",
                "REAL WORLD: How do engineers design energy-efficient buildings?",
                "REAL WORLD: How do scientists use friction in everyday applications?"
            ],
            engineering: [
                "What is the engineering design process?",
                "How do engineers solve problems?",
                "What are materials and their properties?",
                "How do you test and improve designs?",
                "What is a prototype?",
                "Explain the importance of constraints",
                "How do engineers work in teams?",
                "What is innovation in engineering?",
                "PROBLEM: Design a water filter to clean dirty water",
                "PROBLEM: Create a bridge that can hold heavy cars",
                "PROBLEM: Design a solar oven to cook food",
                "PROBLEM: Build a device to help people with disabilities",
                "REAL WORLD: How do engineers design sustainable cities?",
                "REAL WORLD: How do engineers create solutions for climate change?"
            ]
        };

        function selectCategory(category) {
            currentCategory = category;
            
            // Update category cards
            document.querySelectorAll('.category-card').forEach(card => {
                card.style.borderColor = 'rgba(255,255,255,0.2)';
            });
            event.target.closest('.category-card').style.borderColor = 'rgba(255,255,255,0.6)';
            
            // Show category-specific prompts
            const messages = document.getElementById('gemini-messages');
            const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
            
            messages.innerHTML = `
                <div class="message bot-message">
                    <i class="fas fa-robot"></i>
                    <span>Great! You've selected <strong>${categoryName}</strong>. Here are some questions you can ask:</span>
                </div>
            `;
            
            categoryPrompts[category].forEach(prompt => {
                const promptDiv = document.createElement('div');
                promptDiv.className = 'message bot-message';
                promptDiv.style.cursor = 'pointer';
                promptDiv.style.marginBottom = '10px';
                promptDiv.innerHTML = `
                    <i class="fas fa-lightbulb"></i>
                    <span onclick="askPrompt('${prompt}')" style="text-decoration: underline;">${prompt}</span>
                `;
                messages.appendChild(promptDiv);
            });
            
            // Update input placeholder
            document.getElementById('gemini-input').placeholder = `Ask about ${categoryName}...`;
            
            // Scroll to bottom
            messages.scrollTop = messages.scrollHeight;
        }

        function askPrompt(prompt) {
            document.getElementById('gemini-input').value = prompt;
            sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('gemini-input');
            const messages = document.getElementById('gemini-messages');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.innerHTML = `<i class="fas fa-user"></i><span>${message}</span>`;
            messages.appendChild(userMessage);
            
            // Clear input
            input.value = '';
            
            // Scroll to bottom
            messages.scrollTop = messages.scrollHeight;
            
            // Save chat history
            saveChatHistory();
            
            // Generate AI response based on category
            setTimeout(() => {
                const botMessage = document.createElement('div');
                botMessage.className = 'message bot-message';
                botMessage.innerHTML = `<i class="fas fa-robot"></i><span>${getCurriculumResponse(message, currentCategory)}</span>`;
                messages.appendChild(botMessage);
                messages.scrollTop = messages.scrollHeight;
                
                // Save chat history after bot response
                saveChatHistory();
            }, 1000);
        }

        function saveChatHistory() {
            const messages = document.getElementById('gemini-messages');
            const chatHistory = [];
            
            messages.querySelectorAll('.message').forEach(msg => {
                const isUser = msg.classList.contains('user-message');
                const text = msg.querySelector('span').textContent;
                chatHistory.push({ isUser, text });
            });
            
            localStorage.setItem('gemini_chat_history', JSON.stringify(chatHistory));
        }

        function loadChatHistory() {
            const savedHistory = localStorage.getItem('gemini_chat_history');
            if (savedHistory) {
                const chatHistory = JSON.parse(savedHistory);
                const messages = document.getElementById('gemini-messages');
                
                // Clear default message
                messages.innerHTML = '';
                
                chatHistory.forEach(msg => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${msg.isUser ? 'user-message' : 'bot-message'}`;
                    messageDiv.innerHTML = `<i class="fas fa-${msg.isUser ? 'user' : 'robot'}"></i><span>${msg.text}</span>`;
                    messages.appendChild(messageDiv);
                });
                
                messages.scrollTop = messages.scrollHeight;
            }
        }

        function getCurriculumResponse(userMessage, category) {
            const lowerMessage = userMessage.toLowerCase();
            
            // Comprehensive Science Knowledge Base
            const scienceDB = {
                vocabulary: {
                    'adaptation': "An adaptation is a trait that helps an organism survive in its environment. For example, a giraffe's long neck helps it reach leaves high in trees, and a polar bear's white fur helps it blend in with snow. Engineers study animal adaptations to design better products, like Velcro inspired by burr plants! 🦒❄️🔬",
                    'ecosystem': "An ecosystem is a community of living and non-living things that interact with each other. It includes plants, animals, soil, water, and air all working together. Scientists study ecosystems to help protect endangered species and restore damaged environments! 🌍🌱",
                    'photosynthesis': "Photosynthesis is the process plants use to make food using sunlight, water, and carbon dioxide. They produce glucose (sugar) and oxygen as a result. Scientists are studying photosynthesis to create artificial leaves that could help solve energy problems! 🌞🌿⚡",
                    'food chain': "A food chain shows how energy flows from one organism to another. For example: Grass → Rabbit → Hawk. Understanding food chains helps farmers protect crops and scientists maintain healthy ecosystems! 🐰🦅",
                    'producer': "A producer is an organism that makes its own food, usually plants. Examples include grass, trees, and algae. Producers are essential for all life on Earth - they're the foundation of every food chain! 🌿",
                    'consumer': "A consumer is an organism that eats other organisms for food. This includes herbivores (plant eaters), carnivores (meat eaters), and omnivores (eat both). Humans are consumers too! 🍎",
                    'decomposer': "A decomposer is an organism that breaks down dead plants and animals. Examples include bacteria, fungi, and earthworms. Decomposers are nature's recyclers - they turn waste into nutrients for new plants! ♻️",
                    'habitat': "A habitat is the natural home or environment of an animal or plant. Examples include forest, ocean, and desert habitats. Conservationists work to protect habitats so animals and plants can survive and thrive! 🏞️",
                    'migration': "Migration is the seasonal movement of animals from one place to another. Examples include birds flying south for winter and monarch butterflies traveling. Scientists track animal migration to understand climate change! 🦅",
                    'hibernation': "Hibernation is a deep sleep that some animals enter during winter. Examples include bears sleeping in caves and groundhogs in burrows. Understanding hibernation helps scientists develop new medical treatments for humans! 🐻",
                    'weathering': "Weathering is the breaking down of rocks by wind, water, ice, or living things. Examples include water freezing in cracks and tree roots breaking rocks. Weathering creates soil that farmers need to grow our food! 🌾",
                    'erosion': "Erosion is the movement of weathered rock and soil by wind, water, or ice. Examples include rivers carrying sediment and wind moving sand dunes. Understanding erosion helps engineers build stronger bridges! 🌊",
                    'rock cycle': "The rock cycle is the process of rocks changing from one type to another over time. Igneous rocks can become sedimentary, then metamorphic. The rock cycle creates valuable resources like marble for buildings! 🏗️",
                    'energy': "Energy is the ability to do work or cause change. Types include light, heat, motion, sound, and electrical energy. Energy powers everything from cars to computers to our own bodies! ⚡",
                    'force': "A force is a push or pull that can change an object's motion. Examples include pushing a door, pulling a wagon, and gravity pulling down. Forces are everywhere - even when you're sitting still! 🪑",
                    'gravity': "Gravity is the force that pulls objects toward each other. Examples include apples falling from trees and the Moon orbiting Earth. Gravity keeps us on Earth and makes the Moon go around us! 🌙",
                    'simple machine': "A simple machine is a basic tool that makes work easier. Examples include levers, pulleys, wheels, and inclined planes. Simple machines are everywhere - from scissors to car jacks! 🔧"
                },
                animals: {
                    'adaptation': "Animals adapt to their environment in many ways! Physical adaptations include camouflage, sharp claws, or thick fur. Behavioral adaptations include migration, hibernation, or hunting in groups. Engineers study these adaptations to solve human problems! 🦎🔬",
                    'camouflage': "Camouflage helps animals hide from predators or sneak up on prey. Examples include chameleons changing color, arctic foxes turning white in winter, and stick insects looking like twigs. Military uniforms use camouflage too! 🦎👕",
                    'migration': "Migration is when animals travel long distances to find food, water, or better weather. Examples include birds flying south for winter, monarch butterflies traveling thousands of miles, and caribou herds moving across the tundra. Scientists track migration to protect these amazing journeys! 🦅🦋",
                    'hibernation': "Hibernation is when animals sleep through winter to save energy. Examples include bears sleeping in caves, groundhogs in burrows, and bats in caves. Their heart rate slows down and they don't eat. Understanding hibernation helps scientists develop new medical treatments! 🐻💤",
                    'food chain': "Food chains show who eats whom in nature. For example: Grass → Rabbit → Hawk → Decomposers. Each level provides energy for the next. If one part disappears, the whole chain can be affected. This is why protecting all animals is important! 🐰🦅",
                    'habitat': "A habitat is where an animal lives and finds everything it needs to survive. Forest animals need trees for shelter, ocean animals need water to breathe, and desert animals need ways to stay cool. When habitats are destroyed, animals lose their homes. Conservationists work to protect habitats! 🏞️🦌"
                },
                plants: {
                    'structure': "Plants have different parts with specific jobs! Roots anchor plants and absorb water, stems transport nutrients and support leaves, leaves make food through photosynthesis, flowers attract pollinators, and fruits protect seeds. Each part is perfectly designed for its job! 🌱🔬",
                    'photosynthesis': "Photosynthesis is how plants make their own food using sunlight, water, and carbon dioxide. They produce glucose (sugar) for energy and oxygen for us to breathe. This amazing process happens in the leaves and is essential for all life on Earth! 🌞🌿💨",
                    'life cycle': "Plants have a life cycle: Seeds → Sprout → Seedling → Adult Plant → Flowers → Fruits → Seeds. The cycle repeats when seeds are spread by wind, water, or animals. Some plants live for just one year, others for thousands of years! 🌱🌸🍎",
                    'adaptation': "Plants have amazing adaptations! Cactus spines protect from animals and reduce water loss, water lily leaves float on water to get sunlight, Venus flytraps catch insects for nutrients, and pine needles stay green all year. Each adaptation helps the plant survive in its environment! 🌵🪴🌲",
                    'roots': "Roots are amazing! They anchor plants in the ground, absorb water and nutrients from soil, and some store food like carrots and potatoes. Some roots can grow very deep to find water, while others spread wide to catch rain. Without roots, plants couldn't survive! 🥕🌱",
                    'leaves': "Leaves are the food factories of plants! They use sunlight to make food through photosynthesis. Leaves come in many shapes and sizes - some are broad to catch lots of sunlight, others are needle-shaped to reduce water loss. In fall, leaves change color and fall off to save energy! 🍃🍂"
                },
                earthScience: {
                    'layers': "Earth has four main layers! The crust is the thin outer layer where we live, the mantle is the thick middle layer of hot flowing rock, the outer core is liquid molten metal, and the inner core is solid iron and nickel. The deeper you go, the hotter it gets! 🌍🔥",
                    'rock cycle': "The rock cycle shows how rocks change over time! Igneous rocks form from cooled lava, sedimentary rocks form from layers of sediment (often containing fossils), and metamorphic rocks form when heat and pressure change existing rocks. This cycle has been happening for billions of years! 🌋🏔️",
                    'weathering': "Weathering breaks down rocks into smaller pieces! Physical weathering includes wind, water, ice, and temperature changes. Chemical weathering includes acid rain dissolving rocks. Biological weathering includes plant roots and animal burrowing. Weathering creates soil that plants need to grow! 🌪️🌱",
                    'erosion': "Erosion moves weathered rock and soil from one place to another! Water erosion includes rivers carving valleys and waves shaping coastlines. Wind erosion includes sand dunes moving across deserts. Ice erosion includes glaciers carving mountains. Understanding erosion helps engineers build stronger structures! 🌊🏔️",
                    'earthquake': "Earthquakes happen when tectonic plates move suddenly! They can cause the ground to shake, buildings to collapse, and tsunamis in the ocean. Scientists study earthquakes to help predict them and design safer buildings. The largest recorded earthquake was in Chile in 1960! 🌍💥",
                    'volcano': "Volcanoes are openings in Earth's crust where lava, ash, and gases escape! Some volcanoes are active and erupt regularly, others are dormant or extinct. Volcanic eruptions can be destructive but also create new land and fertile soil. The Ring of Fire around the Pacific Ocean has many active volcanoes! 🌋🔥"
                },
                physicalScience: {
                    'energy': "Energy is the ability to do work or cause change! Types include light energy from the sun, heat energy that makes things warm, motion energy from moving objects, sound energy from vibrations, and electrical energy that powers our devices. Energy can change from one type to another! ⚡🔄",
                    'stored energy': "Stored energy is energy that is held within a system or object until some change in the system or object releases it! Examples include chemical energy in batteries, potential energy in a stretched rubber band, and gravitational potential energy in a ball held high above the ground. When released, stored energy can be converted into other forms! 🔋⚡",
                    'conversion': "Conversion is a change in nature, form, or units! In science, energy conversion means changing energy from one form to another. For example, a battery converts chemical energy to electrical energy, a light bulb converts electrical energy to light and heat energy, and a solar panel converts light energy to electrical energy! 🔄⚡",
                    'chemical energy': "Chemical energy is stored energy in the bonds between atoms in molecules! It's released during chemical reactions. Examples include the energy in food that powers our bodies, the energy in gasoline that powers cars, and the energy in batteries that powers electronic devices. When chemical bonds break, energy is released! 🧪⚡",
                    'electrical energy': "Electrical energy is energy from the movement of electric charges! It powers our lights, computers, and appliances. Electrical energy can be generated by batteries, solar panels, or power plants. It can be converted into light, heat, sound, or motion energy in various devices! ⚡🔌",
                    'light energy': "Light energy is energy that allows us to see! It travels in waves and comes from sources like the sun, light bulbs, and fire. Light energy can be reflected (bounced off mirrors), refracted (bent through lenses), or absorbed (taken in by dark objects). Plants use light energy for photosynthesis! ☀️💡",
                    'sound energy': "Sound energy is energy that travels in waves through the air or water and vibrates the eardrum upon contact! It's created when objects vibrate and makes air molecules move. Sound travels faster through solids than through air. Examples include music, speech, and the sound of thunder! 🔊🎵",
                    'heat energy': "Heat energy is energy that causes a change in temperature between materials! It flows from warmer objects to cooler objects. Heat energy can be produced by friction, chemical reactions, or electrical resistance. It's essential for cooking, heating our homes, and many industrial processes! 🔥🌡️",
                    'energy transfer': "Energy transfer is when energy moves from one object to another! Examples include a bowling ball hitting pins (motion energy transfers), a light bulb turning electrical energy into light and heat, and sound waves carrying energy through air. Energy is never created or destroyed, just transferred! 🎳💡🔊",
                    'collision': "A collision is when two objects hit each other and energy is transferred! In a bowling ball collision, the ball's motion energy transfers to the pins, making them move. The harder the collision, the more energy is transferred. Scientists study collisions to understand how energy moves! 🎳⚡",
                    'motion': "Motion is when an object changes position over time! Objects can move in straight lines, curves, or circles. Speed is how fast something moves, and direction is which way it's going. Understanding motion helps engineers design safer cars and faster airplanes! 🏃✈️",
                    'force': "A force is a push or pull that can change an object's motion! Examples include pushing a door open, pulling a wagon, gravity pulling objects down, and friction slowing things down. Forces are everywhere - even when you're sitting still, gravity is pulling you down! 🪑🌍",
                    'gravity': "Gravity is the force that pulls objects toward each other! On Earth, gravity pulls everything toward the center, which is why things fall down. The Moon's gravity causes ocean tides, and the Sun's gravity keeps planets in orbit. Without gravity, we'd float away into space! 🌙🌊",
                    'friction': "Friction is a force that slows down objects when they rub against each other! It helps us walk without slipping and makes brakes work on cars. But friction also creates heat and wastes energy, so engineers try to reduce it in machines. Different surfaces create different amounts of friction! 👟🔥",
                    'simple machine': "Simple machines make work easier! A lever (like a see-saw) helps lift heavy things, a pulley (like a flagpole) lifts objects up, a wheel reduces friction for easier movement, and an inclined plane (like a ramp) makes moving objects easier. Complex machines are combinations of simple machines! 🔧⚖️",
                    'lever': "A lever is a simple machine with a fulcrum (pivot point), effort (where you push), and load (what you're lifting)! Examples include see-saws, crowbars, and scissors. The closer the load is to the fulcrum, the easier it is to lift! ⚖️🔧",
                    'pulley': "A pulley is a simple machine that uses a wheel and rope to lift heavy objects! Fixed pulleys change direction, movable pulleys reduce effort, and compound pulleys combine both. Pulleys are used in flagpoles, cranes, and elevators! 🏗️⚙️",
                    'wheel and axle': "A wheel and axle is a simple machine that makes rolling easier! The wheel is the larger part that touches the ground, and the axle is the smaller part in the center. Examples include car wheels, doorknobs, and steering wheels! 🚗🎡",
                    'inclined plane': "An inclined plane is a simple machine that makes moving objects easier by spreading the work over a longer distance! Examples include ramps, stairs, and slides. The longer the ramp, the easier it is to move something up! 🛤️📐",
                    'electricity': "Electricity is the flow of electric charge through a conductor! It powers our lights, computers, and appliances. Electricity can be generated by batteries, solar panels, or power plants. Understanding electricity helps engineers design circuits and power systems! ⚡🔌",
                    'circuit': "A circuit is a complete path for electricity to flow! It needs a power source (like a battery), conductors (like wires), and a load (like a light bulb). If the circuit is broken, electricity can't flow and the light won't work! 🔋💡",
                    'conductor': "A conductor is a material that allows electricity to flow through it easily! Examples include copper wire, aluminum, and water. Conductors are used to make electrical wires and circuits! 🔌⚡",
                    'insulator': "An insulator is a material that stops electricity from flowing through it! Examples include rubber, plastic, and wood. Insulators are used to cover electrical wires to keep us safe from electric shocks! 🛡️⚡",
                    'light': "Light is a form of energy that travels in waves! It comes from sources like the sun, light bulbs, and fire. Light can be reflected (bounced off mirrors), refracted (bent through lenses), or absorbed (taken in by dark objects)! ☀️💡",
                    'sound': "Sound is a form of energy that travels as vibrations through air, water, or solids! It's created when objects vibrate and makes air molecules move. Sound travels faster through solids than through air! 🔊🎵",
                    'magnetism': "Magnetism is a force that attracts or repels certain materials! Magnets have north and south poles - opposite poles attract, same poles repel. Earth itself is a giant magnet, which is why compasses work! 🧲🧭",
                    'magnet': "A magnet is an object that produces a magnetic field! It attracts materials like iron, nickel, and cobalt. Magnets are used in compasses, electric motors, and refrigerator doors! 🧲⚙️",
                    'battery': "A battery is a device that stores chemical energy and converts it to electrical energy! It contains chemicals that react to produce electricity. When the chemicals are used up, the battery stops working. Batteries power everything from flashlights to electric cars! 🔋⚡",
                    'flashlight': "A flashlight is a portable light source that uses stored energy! It contains a battery (chemical energy) that converts to electrical energy, which then converts to light energy. When you flip the switch, you complete the circuit and the light turns on! 🔦💡",
                    'calorie': "A calorie is a unit of measurement used to measure the amount of stored chemical energy in food! The size and activity level of an animal affects the number of calories it needs. Small animals need few calories, while large animals need thousands or millions of calories each day! 🍎⚡",
                    'digestion': "Digestion is the process of breaking down food to release chemical energy! As food is digested, the chemical energy becomes available for life processes like breathing, moving, growing, and thinking. Different foods provide different amounts of energy! 🍽️⚡",
                    'chemical reaction': "A chemical reaction is a process where substances change into new substances! Signs include color change, temperature change, gas production, or formation of a solid. Examples include rusting iron, burning fuel, and photosynthesis in plants! 🧪⚡",
                    'photosynthesis': "Photosynthesis is how plants convert solar energy into stored chemical energy! Plants use sunlight, carbon dioxide, and water to create glucose (stored energy) and oxygen. This process provides energy for the plant and oxygen for animals! 🌱☀️",
                    'respiration': "Respiration is how organisms use oxygen to convert stored energy into usable energy! It's the opposite of photosynthesis - organisms use oxygen to break down glucose and release energy for life processes. This happens in every cell of your body! 🫁⚡"
                },
                engineering: {
                    'design process': "Engineers use a design process to solve problems! 1) Ask what problem needs solving, 2) Imagine possible solutions, 3) Plan the best solution, 4) Create a prototype, 5) Test it out, 6) Improve based on what you learned. This process is used to create everything from bridges to apps! 🤔💡🛠️",
                    'problem solving': "Engineering is all about solving real-world problems! Engineers design bridges to cross rivers safely, create water filters to clean dirty water, build wind turbines for clean energy, design prosthetics to help people, and create apps to solve everyday problems. Every invention starts with a problem that needs solving! 🌉💧💨",
                    'innovation': "Innovation means creating new solutions to old problems! Engineers are constantly improving existing technology and creating new inventions. Examples include solar panels that turn sunlight into electricity, electric cars that don't pollute, and medical devices that save lives. Innovation makes the world better! ☀️🚗🏥",
                    'sustainability': "Sustainable engineering means creating solutions that don't harm the environment! Examples include renewable energy sources like wind and solar power, water conservation systems, and biodegradable materials. Engineers work to create a better future for everyone! 🌱♻️🌍"
                }
            };
            
            // Handle problem-solving scenarios
            if (lowerMessage.includes('problem:')) {
                return getProblemSolvingResponse(userMessage, category);
            }
            
            // Handle real-world applications
            if (lowerMessage.includes('real world:')) {
                return getRealWorldResponse(userMessage, category);
            }
            
            // Search for matching terms in the knowledge base
            for (const [term, response] of Object.entries(scienceDB[category] || {})) {
                if (lowerMessage.includes(term)) {
                    return response;
                }
            }
            
            // Default responses for each category
            if (category === 'vocabulary') {
                return "I can help explain science vocabulary! Try asking about specific terms like adaptation, ecosystem, photosynthesis, food chain, weathering, erosion, energy, force, gravity, or simple machines. Each term has real-world applications that make science exciting! 🔬✨";
            } else if (category === 'animals') {
                return "I love talking about animals! Ask me about adaptations, camouflage, migration, hibernation, food chains, or habitats. Animals have amazing survival strategies that engineers study to solve human problems! 🦎🔬";
            } else if (category === 'plants') {
                return "Plants are fascinating! Ask me about plant structures, photosynthesis, life cycles, adaptations, roots, or leaves. Plants are essential for all life on Earth and have incredible survival strategies! 🌱🌿";
            } else if (category === 'earth science') {
                return "Earth science is amazing! Ask me about Earth's layers, the rock cycle, weathering, erosion, earthquakes, or volcanoes. Understanding Earth helps us protect our planet and use its resources wisely! 🌍🌋";
            } else if (category === 'physical science') {
                return "Physical science explains how things work! Ask me about energy, motion, forces, gravity, friction, or simple machines. These concepts help engineers design everything from cars to computers! ⚡🔧";
            } else if (category === 'engineering') {
                return "Engineering solves real-world problems! Ask me about the design process, problem solving, innovation, or sustainability. Engineers create solutions that make the world better for everyone! 🛠️🌍";
            }
            
            return "I'm here to help with all your 4th grade science questions! Select a category above or ask me about any science topic. I can explain vocabulary, give real-world examples, and help you understand how science works in everyday life! 🔬✨";
        }

        function getProblemSolvingResponse(userMessage, category) {
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('farmer') && lowerMessage.includes('crops') && lowerMessage.includes('rabbits')) {
                return "Great problem! Here's how we can help the farmer: 1) Build a fence around the crops to keep rabbits out, 2) Plant crops that rabbits don't like, 3) Use natural predators like owls to control rabbit population, 4) Create a separate area with rabbit-friendly plants to attract them away from crops. This is how farmers use science to protect their food! 🌾🐰🦉";
            }
            
            if (lowerMessage.includes('birds') && lowerMessage.includes('homes') && lowerMessage.includes('deforestation')) {
                return "Excellent problem! Here's how we can help birds: 1) Plant new trees to replace the ones cut down, 2) Create birdhouses and nesting boxes, 3) Protect existing forests from being cut down, 4) Create wildlife corridors connecting forest areas. Scientists and conservationists work together to protect animal habitats! 🐦🌲🏠";
            }
            
            if (lowerMessage.includes('zoo') && lowerMessage.includes('polar bears')) {
                return "Awesome design challenge! A polar bear habitat needs: 1) A large pool of cold water for swimming, 2) Ice and snow areas for playing, 3) Shaded areas to stay cool, 4) Rocks and platforms for climbing, 5) A den for sleeping, 6) Toys and enrichment activities. Zoo designers use animal behavior science to create the best homes! 🐻❄️🏗️";
            }
            
            if (lowerMessage.includes('sea turtles') && lowerMessage.includes('endangered')) {
                return "Important conservation problem! We can help sea turtles by: 1) Protecting their nesting beaches from development, 2) Reducing plastic pollution in oceans, 3) Using turtle-friendly fishing nets, 4) Creating marine protected areas, 5) Educating people about turtle conservation. Marine biologists work hard to save these amazing animals! 🐢🌊♻️";
            }
            
            if (lowerMessage.includes('garden') && lowerMessage.includes('not growing')) {
                return "Let's solve this garden problem! Check these things: 1) Is there enough sunlight? (Most plants need 6+ hours), 2) Is the soil good? (Add compost or fertilizer), 3) Are you watering correctly? (Not too much or too little), 4) Are there pests eating the plants? (Look for bugs or holes), 5) Is the soil pH right? (Test with a kit). Gardeners use science to grow healthy plants! 🌱🔬🌞";
            }
            
            if (lowerMessage.includes('drought') && lowerMessage.includes('plants')) {
                return "Smart water conservation problem! Help plants survive drought by: 1) Using drip irrigation to water roots directly, 2) Adding mulch to keep soil moist, 3) Choosing drought-resistant plants, 4) Watering early morning or evening, 5) Collecting rainwater in barrels. This is how farmers in dry areas grow food sustainably! 💧🌵🌾";
            }
            
            if (lowerMessage.includes('flooding') && lowerMessage.includes('heavy rain')) {
                return "Important engineering problem! We can help with flooding by: 1) Building better drainage systems, 2) Creating retention ponds to hold extra water, 3) Planting trees to absorb water, 4) Building flood barriers, 5) Improving storm drains. Civil engineers design these solutions to protect communities! 🌊🏗️🌳";
            }
            
            if (lowerMessage.includes('beach') && lowerMessage.includes('erosion')) {
                return "Coastal engineering challenge! Protect beaches from erosion by: 1) Building breakwaters to reduce wave energy, 2) Planting beach grass to hold sand, 3) Creating artificial reefs, 4) Adding sand to rebuild beaches, 5) Building seawalls. Coastal engineers use science to protect our shorelines! 🏖️🌊🛡️";
            }
            
            if (lowerMessage.includes('electricity') && lowerMessage.includes('storm')) {
                return "Power system problem! Help during power outages by: 1) Using backup generators, 2) Installing solar panels with batteries, 3) Creating microgrids for neighborhoods, 4) Using wind turbines, 5) Storing energy in large batteries. Electrical engineers design these systems to keep power running! ⚡🌪️🔋";
            }
            
            if (lowerMessage.includes('heavy box') && lowerMessage.includes('stairs')) {
                return "Simple machine problem! Move the heavy box using: 1) A ramp (inclined plane) to roll it up, 2) A pulley system to lift it, 3) A lever to help lift it, 4) A wheel and axle to roll it, 5) Teamwork to share the load. Engineers use simple machines to make work easier! 📦🛠️⚖️";
            }
            
            if (lowerMessage.includes('water filter') && lowerMessage.includes('dirty water')) {
                return "Engineering design challenge! Create a water filter using: 1) Gravel to catch large particles, 2) Sand to catch smaller particles, 3) Activated charcoal to remove chemicals, 4) Coffee filters for fine particles, 5) A container to hold everything. This is how water treatment plants clean our drinking water! 💧🔬🏭";
            }
            
            if (lowerMessage.includes('bridge') && lowerMessage.includes('heavy cars')) {
                return "Structural engineering problem! Design a strong bridge by: 1) Using triangles for strength, 2) Building thick support columns, 3) Using strong materials like steel and concrete, 4) Testing with models first, 5) Following the engineering design process. Civil engineers build bridges that last for decades! 🌉🏗️🚗";
            }
            
            if (lowerMessage.includes('solar oven') && lowerMessage.includes('cook food')) {
                return "Renewable energy challenge! Build a solar oven by: 1) Using a pizza box with aluminum foil inside, 2) Adding a clear plastic window to trap heat, 3) Painting the inside black to absorb sunlight, 4) Using insulation to keep heat in, 5) Pointing it toward the sun. This shows how solar energy can cook food! ☀️🍕📦";
            }
            
            if (lowerMessage.includes('bowling ball') && lowerMessage.includes('knock down') && lowerMessage.includes('pins')) {
                return "Great collision engineering problem! Improve bowling ball collisions by: 1) Increasing the ball's speed for more energy transfer, 2) Making the ball heavier to transfer more momentum, 3) Aiming for the center of the pin formation, 4) Using a smooth, polished ball surface, 5) Ensuring the lane is level and clean. This is how collision engineers study energy transfer! 🎳⚡🔬";
            }
            
            if (lowerMessage.includes('pulley system') && lowerMessage.includes('lift heavy objects')) {
                return "Excellent simple machine challenge! Design a pulley system by: 1) Using a fixed pulley to change direction, 2) Adding movable pulleys to reduce effort, 3) Creating a compound pulley system for maximum advantage, 4) Using strong rope and secure anchor points, 5) Testing with gradually heavier loads. This is how engineers design lifting systems! 🏗️⚙️💪";
            }
            
            if (lowerMessage.includes('circuit') && lowerMessage.includes('lights up multiple bulbs')) {
                return "Electric engineering challenge! Create a multi-bulb circuit by: 1) Using a series circuit (bulbs connected in a line), 2) Using a parallel circuit (bulbs connected side by side), 3) Ensuring proper voltage and current flow, 4) Using appropriate wire gauge and connections, 5) Testing each bulb individually. This is how electricians design lighting systems! 💡⚡🔌";
            }
            
            if (lowerMessage.includes('ramp') && lowerMessage.includes('moving objects easier')) {
                return "Inclined plane engineering! Build an effective ramp by: 1) Making it longer to reduce the angle, 2) Using smooth, low-friction materials, 3) Adding side rails for safety, 4) Testing with different objects and weights, 5) Measuring the effort needed to push objects up. This is how engineers design accessible ramps! 🛤️📐⚖️";
            }
            
            if (lowerMessage.includes('friction challenge') && lowerMessage.includes('toy cars')) {
                return "Friction engineering problem! Design a friction challenge by: 1) Creating ramps with different surface textures, 2) Testing carpet, sandpaper, aluminum foil, and smooth surfaces, 3) Measuring how far cars travel on each surface, 4) Using the same car and starting height for fair testing, 5) Recording data to compare friction effects. This is how engineers study friction! 🚗🏁🔬";
            }
            
            if (lowerMessage.includes('domino chain') && lowerMessage.includes('reaction')) {
                return "Chain reaction engineering! Create a domino chain by: 1) Setting up dominoes in a line with proper spacing, 2) Using consistent domino sizes and weights, 3) Creating curves and turns for interesting patterns, 4) Adding ramps and height changes for variety, 5) Testing small sections before building the full chain. This demonstrates energy transfer through collisions! 🎲⚡🔗";
            }
            
            return "That's a great problem to solve! Use the engineering design process: 1) Ask what the problem is, 2) Imagine possible solutions, 3) Plan your best idea, 4) Create a prototype, 5) Test it out, 6) Improve based on what you learn. Engineers solve problems like this every day! 🤔💡🛠️";
        }

        function getRealWorldResponse(userMessage, category) {
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('engineers') && lowerMessage.includes('animal adaptations')) {
                return "Amazing real-world connection! Engineers study animal adaptations to solve human problems: 1) Velcro was inspired by burr plants, 2) Bullet trains mimic kingfisher beaks for speed, 3) Gecko feet inspired super-strong adhesives, 4) Whale fins inspired wind turbine blades, 5) Shark skin inspired swimsuit materials. Biomimicry helps engineers create better technology! 🦎🔬🚄";
            }
            
            if (lowerMessage.includes('scientists') && lowerMessage.includes('migration')) {
                return "Fascinating real-world science! Scientists track animal migration by: 1) Using GPS collars to follow animals, 2) Studying satellite images of migration routes, 3) Using radar to track bird flights, 4) Analyzing DNA to understand migration patterns, 5) Creating protected corridors for safe travel. This helps protect endangered species! 🦅🛰️🌍";
            }
            
            if (lowerMessage.includes('farmers') && lowerMessage.includes('science') && lowerMessage.includes('crops')) {
                return "Incredible agricultural science! Farmers use science to grow better crops by: 1) Testing soil to know what nutrients to add, 2) Using weather data to plan planting, 3) Breeding plants for better traits, 4) Using precision agriculture with GPS, 5) Managing pests with integrated pest management. This helps feed the world! 🌾🔬🌱";
            }
            
            if (lowerMessage.includes('plants') && lowerMessage.includes('clean polluted water')) {
                return "Amazing environmental science! Scientists use plants to clean water by: 1) Phytoremediation - plants absorb pollutants, 2) Wetlands filter water naturally, 3) Algae remove excess nutrients, 4) Water hyacinths clean heavy metals, 5) Mangrove trees protect coastlines. Nature's own water treatment system! 🌱💧🌿";
            }
            
            if (lowerMessage.includes('engineers') && lowerMessage.includes('earthquake-resistant')) {
                return "Life-saving engineering! Engineers build earthquake-resistant buildings by: 1) Using flexible materials that bend instead of break, 2) Adding shock absorbers to absorb energy, 3) Building strong foundations that move with the ground, 4) Using cross-bracing for extra strength, 5) Testing designs with earthquake simulators. This saves lives during earthquakes! 🏢🌍🛡️";
            }
            
            if (lowerMessage.includes('scientists') && lowerMessage.includes('natural disasters')) {
                return "Critical disaster science! Scientists predict and prepare for disasters by: 1) Monitoring weather patterns for storms, 2) Tracking earthquake activity with seismographs, 3) Using satellite data to predict floods, 4) Creating early warning systems, 5) Studying past disasters to improve preparation. This helps communities stay safe! 🌪️📡🚨";
            }
            
            if (lowerMessage.includes('engineers') && lowerMessage.includes('wind turbines')) {
                return "Clean energy engineering! Engineers design wind turbines by: 1) Studying aerodynamics for efficient blades, 2) Using strong materials to withstand storms, 3) Placing turbines in windy locations, 4) Designing gearboxes to convert wind to electricity, 5) Creating smart grids to distribute power. This helps create clean, renewable energy! 💨⚡🌱";
            }
            
            if (lowerMessage.includes('scientists') && lowerMessage.includes('simple machines')) {
                return "Everyday engineering! Scientists use simple machines everywhere: 1) Levers in car jacks and scissors, 2) Pulleys in elevators and cranes, 3) Wheels in cars and bicycles, 4) Inclined planes in ramps and stairs, 5) Wedges in knives and axes. These make work easier and more efficient! 🔧⚖️🚗";
            }
            
            if (lowerMessage.includes('engineers') && lowerMessage.includes('sustainable cities')) {
                return "Future city planning! Engineers design sustainable cities by: 1) Using renewable energy sources, 2) Creating efficient public transportation, 3) Building green buildings with solar panels, 4) Designing water recycling systems, 5) Planning green spaces and urban forests. This creates cities that are good for people and the planet! 🏙️🌱♻️";
            }
            
            if (lowerMessage.includes('engineers') && lowerMessage.includes('climate change')) {
                return "Global problem solving! Engineers create climate solutions by: 1) Developing renewable energy technologies, 2) Designing carbon capture systems, 3) Creating energy-efficient buildings, 4) Building electric vehicles, 5) Developing sustainable materials. Engineers are working to solve the biggest challenge of our time! 🌍🔬⚡";
            }
            
            if (lowerMessage.includes('collision engineers') && lowerMessage.includes('cars safer')) {
                return "Life-saving engineering! Collision engineers make cars safer by: 1) Designing crumple zones that absorb crash energy, 2) Creating airbag systems that deploy in milliseconds, 3) Using seat belts that lock during sudden stops, 4) Building roll cages to protect passengers, 5) Testing cars in crash simulations. This saves thousands of lives every year! 🚗🛡️💥";
            }
            
            if (lowerMessage.includes('electricians') && lowerMessage.includes('safe circuits')) {
                return "Safety engineering! Electricians design safe circuits by: 1) Using proper wire sizing for current loads, 2) Installing circuit breakers to prevent overloads, 3) Grounding systems to prevent electric shocks, 4) Using GFCI outlets in wet areas, 5) Following electrical codes and standards. This keeps our homes and buildings safe! ⚡🛡️🏠";
            }
            
            if (lowerMessage.includes('engineers') && lowerMessage.includes('magnetism') && lowerMessage.includes('technology')) {
                return "Magnetic innovation! Engineers use magnetism in technology by: 1) Creating electric motors for cars and appliances, 2) Building MRI machines for medical imaging, 3) Designing magnetic levitation trains, 4) Using magnetic storage in hard drives, 5) Creating magnetic sensors for navigation. Magnetism powers modern technology! 🧲⚙️🔬";
            }
            
            if (lowerMessage.includes('scientists') && lowerMessage.includes('energy transfer') && lowerMessage.includes('sports')) {
                return "Sports science! Scientists study energy transfer in sports by: 1) Analyzing how athletes transfer energy from muscles to equipment, 2) Designing better sports equipment using physics, 3) Studying collision impacts in contact sports, 4) Optimizing energy efficiency in athletic movements, 5) Using motion capture to analyze performance. This helps athletes perform better and stay safer! 🏃⚡🏆";
            }
            
            if (lowerMessage.includes('engineers') && lowerMessage.includes('energy-efficient buildings')) {
                return "Green building engineering! Engineers design energy-efficient buildings by: 1) Using solar panels to generate electricity, 2) Installing smart thermostats to control heating and cooling, 3) Using LED lighting that uses less energy, 4) Designing better insulation to keep heat in, 5) Creating natural ventilation systems. This reduces energy costs and helps the environment! 🏢🌱⚡";
            }
            
            if (lowerMessage.includes('scientists') && lowerMessage.includes('friction') && lowerMessage.includes('everyday applications')) {
                return "Friction science everywhere! Scientists use friction in everyday applications by: 1) Designing car tires with proper grip for safety, 2) Creating non-slip surfaces for shoes and floors, 3) Using friction in brakes to stop vehicles, 4) Designing sports equipment with optimal grip, 5) Creating medical devices that need controlled friction. Friction is essential for safety and performance! 👟🚗🛡️";
            }
            
            return "Real-world science is everywhere! Scientists and engineers use the concepts you're learning to solve important problems, create new technologies, and make the world a better place. Every scientific discovery can lead to amazing innovations! 🌍🔬✨";
        }
        
        // Add interactive features
        document.addEventListener('DOMContentLoaded', function() {
            // Load progress and update What's Next
            loadProgress();
            loadSectionStates(); // Load collapsible section states
            
            // Gemini chat functionality
            const input = document.getElementById('gemini-input');
            if (input) {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
            
            const bundleSections = document.querySelectorAll('.bundle-section');
            
            bundleSections.forEach(section => {
                const header = section.querySelector('.bundle-header');
                header.addEventListener('click', function() {
                    const lessonStructure = section.querySelector('.lesson-structure');
                    lessonStructure.style.display = 
                        lessonStructure.style.display === 'none' ? 'block' : 'none';
                });
                
                header.style.cursor = 'pointer';
            });
        });

        // ClassDojo Integration Functions
        function openClassDojoMini() {
            window.open('classdojo-mini.html', '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
        }

        function showClassDojoFeatures() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content large-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-smile"></i> ClassDojo Mini Features</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="features-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div class="feature-card" style="background: #f8f9fa; padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2rem; color: #ff6b6b; margin-bottom: 10px;">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h4 style="color: #2d3748; margin-bottom: 10px;">Student Management</h4>
                                <p style="color: #718096; font-size: 0.9rem;">Add students with custom avatars and track their progress</p>
                            </div>
                            
                            <div class="feature-card" style="background: #f8f9fa; padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2rem; color: #ff6b6b; margin-bottom: 10px;">
                                    <i class="fas fa-star"></i>
                                </div>
                                <h4 style="color: #2d3748; margin-bottom: 10px;">Skills & Points</h4>
                                <p style="color: #718096; font-size: 0.9rem;">Create custom skills and award points for positive behaviors</p>
                            </div>
                            
                            <div class="feature-card" style="background: #f8f9fa; padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2rem; color: #ff6b6b; margin-bottom: 10px;">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <h4 style="color: #2d3748; margin-bottom: 10px;">Class Reports</h4>
                                <p style="color: #718096; font-size: 0.9rem;">View detailed reports and track class performance</p>
                            </div>
                            
                            <div class="feature-card" style="background: #f8f9fa; padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2rem; color: #ff6b6b; margin-bottom: 10px;">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <h4 style="color: #2d3748; margin-bottom: 10px;">Achievements</h4>
                                <p style="color: #718096; font-size: 0.9rem;">Track student achievements and celebrate success</p>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="btn-primary" onclick="openClassDojoMini(); closeModal();">
                                <i class="fas fa-external-link-alt"></i> Open ClassDojo Mini
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        // AI Tool Functions
        function generateImage() {
            const prompt = document.getElementById('imagePrompt').value;
            const style = document.getElementById('imageStyle').value;
            const output = document.getElementById('imageOutput');
            
            if (!prompt) {
                alert('Please enter an image prompt');
                return;
            }
            
            output.innerHTML = '<div style="text-align: center; color: #666;"><i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i><br>Generating image...</div>';
            
            // Simulate image generation
            setTimeout(() => {
                const imageUrl = `https://via.placeholder.com/400x300/4285f4/white?text=${encodeURIComponent(prompt.substring(0, 20))}`;
                output.innerHTML = `
                    <div style="text-align: center;">
                        <img src="${imageUrl}" alt="Generated Image" style="max-width: 100%; border-radius: 10px; margin-bottom: 15px;">
                        <div style="color: #666; font-size: 0.9rem;">
                            <strong>Prompt:</strong> ${prompt}<br>
                            <strong>Style:</strong> ${style}
                        </div>
                        <button onclick="downloadImage('${imageUrl}')" class="btn-primary" style="margin-top: 10px;">
                            <i class="fas fa-download"></i> Download Image
                        </button>
                    </div>
                `;
            }, 2000);
        }

        function downloadImage(imageUrl) {
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = 'generated-image.png';
            link.click();
        }

        function generateActivity() {
            const topic = document.getElementById('activityTopic').value;
            const type = document.getElementById('activityType').value;
            const duration = document.getElementById('activityDuration').value;
            const output = document.getElementById('activityOutput');
            
            if (!topic) {
                alert('Please enter an activity topic');
                return;
            }
            
            output.innerHTML = '<div style="text-align: center; color: #666;"><i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i><br>Generating activity...</div>';
            
            // Simulate activity generation
            setTimeout(() => {
                const activities = {
                    'game': {
                        title: `${topic} Memory Game`,
                        description: `Create a memory matching game with ${topic} concepts. Students flip cards to match terms with definitions.`,
                        materials: ['Index cards', 'Markers', 'Timer'],
                        steps: [
                            'Write ${topic} terms on half the cards',
                            'Write definitions on the other half',
                            'Mix cards and place face down',
                            'Students take turns flipping two cards',
                            'Keep matches, return non-matches',
                            'Player with most matches wins'
                        ]
                    },
                    'experiment': {
                        title: `${topic} Investigation`,
                        description: `Hands-on experiment to explore ${topic} concepts through observation and data collection.`,
                        materials: ['Safety goggles', 'Measuring tools', 'Data sheets', '${topic} samples'],
                        steps: [
                            'Introduce the ${topic} concept',
                            'Make predictions about what will happen',
                            'Set up the experiment safely',
                            'Record observations and measurements',
                            'Analyze results and draw conclusions',
                            'Share findings with the class'
                        ]
                    },
                    'discussion': {
                        title: `${topic} Think-Pair-Share`,
                        description: `Structured discussion activity to explore ${topic} concepts through peer interaction.`,
                        materials: ['Discussion questions', 'Timer', 'Chart paper'],
                        steps: [
                            'Present a ${topic} question to the class',
                            'Students think individually for 2 minutes',
                            'Pair up to discuss their thoughts',
                            'Share ideas with the whole class',
                            'Record key points on chart paper',
                            'Summarize main concepts learned'
                        ]
                    },
                    'craft': {
                        title: `${topic} Model Building`,
                        description: `Creative craft activity to build understanding of ${topic} through hands-on construction.`,
                        materials: ['Construction paper', 'Scissors', 'Glue', 'Markers', 'Recycled materials'],
                        steps: [
                            'Introduce the ${topic} concept',
                            'Show examples of what to build',
                            'Provide materials and safety instructions',
                            'Students work individually or in pairs',
                            'Build and decorate their models',
                            'Present models and explain concepts'
                        ]
                    }
                };
                
                const activity = activities[type];
                output.innerHTML = `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h3 style="color: #2d3748; margin-bottom: 15px;">${activity.title}</h3>
                        <p style="color: #666; margin-bottom: 20px;">${activity.description}</p>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #2d3748; margin-bottom: 10px;">Materials Needed:</h4>
                            <ul style="color: #666; margin-left: 20px;">
                                ${activity.materials.map(material => `<li>${material}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div>
                            <h4 style="color: #2d3748; margin-bottom: 10px;">Activity Steps:</h4>
                            <ol style="color: #666; margin-left: 20px;">
                                ${activity.steps.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #e8f5e8; border-radius: 8px;">
                            <strong>Duration:</strong> ${duration} minutes<br>
                            <strong>Grade Level:</strong> 4th Grade<br>
                            <strong>Subject:</strong> STEM
                        </div>
                    </div>
                `;
            }, 1500);
        }
    </script>
    <script src="google-integration.js"></script>
</body>
</html>
image.png